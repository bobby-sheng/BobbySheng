<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>é£ä¹¦&#43;jiaré›†æˆ|SprintæŠ¥å‘Šå¡ç‰‡æ¶ˆæ¯ | Bobby Blog</title>
<meta name="keywords" content="Python">
<meta name="description" content="é£ä¹¦&#43;jiaré›†æˆ SprintæŠ¥å‘Šå¡ç‰‡æ¶ˆæ¯">
<meta name="author" content="Author:&nbsp;Bobby">
<link rel="canonical" href="https://bobby-sheng.github.io/BobbySheng/en/posts/blog/%E9%A3%9E%E4%B9%A6&#43;jiar%E9%9B%86%E6%88%90sprint%E6%8A%A5%E5%91%8A%E5%8D%A1%E7%89%87%E6%B6%88%E6%81%AF/">
<link crossorigin="anonymous" href="/BobbySheng/assets/css/stylesheet.e56cf4f357894de110bad4354fefb20d149fe3e9909b962569b427d5538cb284.css" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/BobbySheng/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js"
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://bobby-sheng.github.io/BobbySheng/img/title.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://bobby-sheng.github.io/BobbySheng/img/title.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://bobby-sheng.github.io/BobbySheng/img/title.png">
<link rel="apple-touch-icon" href="https://bobby-sheng.github.io/BobbySheng/img/title.png">
<link rel="mask-icon" href="https://bobby-sheng.github.io/BobbySheng/img/title.png">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://bobby-sheng.github.io/BobbySheng/en/posts/blog/%E9%A3%9E%E4%B9%A6&#43;jiar%E9%9B%86%E6%88%90sprint%E6%8A%A5%E5%91%8A%E5%8D%A1%E7%89%87%E6%B6%88%E6%81%AF/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = ""; 
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<meta property="og:title" content="é£ä¹¦&#43;jiaré›†æˆ|SprintæŠ¥å‘Šå¡ç‰‡æ¶ˆæ¯" />
<meta property="og:description" content="é£ä¹¦&#43;jiaré›†æˆ SprintæŠ¥å‘Šå¡ç‰‡æ¶ˆæ¯" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bobby-sheng.github.io/BobbySheng/en/posts/blog/%E9%A3%9E%E4%B9%A6&#43;jiar%E9%9B%86%E6%88%90sprint%E6%8A%A5%E5%91%8A%E5%8D%A1%E7%89%87%E6%B6%88%E6%81%AF/" />
<meta property="og:image" content="https://telegraph-image-f19.pages.dev/file/cf7de6d9cd14daa933b2b.jpg" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-05-16T00:00:00+00:00" />
<meta property="article:modified_time" content="2024-05-16T00:00:00+00:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://telegraph-image-f19.pages.dev/file/cf7de6d9cd14daa933b2b.jpg" />
<meta name="twitter:title" content="é£ä¹¦&#43;jiaré›†æˆ|SprintæŠ¥å‘Šå¡ç‰‡æ¶ˆæ¯"/>
<meta name="twitter:description" content="é£ä¹¦&#43;jiaré›†æˆ SprintæŠ¥å‘Šå¡ç‰‡æ¶ˆæ¯"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "âŒ› Thought",
      "item": "https://bobby-sheng.github.io/BobbySheng/en/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "ğŸ—ï¸ Blog",
      "item": "https://bobby-sheng.github.io/BobbySheng/en/posts/blog/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "é£ä¹¦+jiaré›†æˆ|SprintæŠ¥å‘Šå¡ç‰‡æ¶ˆæ¯",
      "item": "https://bobby-sheng.github.io/BobbySheng/en/posts/blog/%E9%A3%9E%E4%B9%A6+jiar%E9%9B%86%E6%88%90sprint%E6%8A%A5%E5%91%8A%E5%8D%A1%E7%89%87%E6%B6%88%E6%81%AF/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "é£ä¹¦+jiaré›†æˆ|SprintæŠ¥å‘Šå¡ç‰‡æ¶ˆæ¯",
  "name": "é£ä¹¦\u002bjiaré›†æˆ|SprintæŠ¥å‘Šå¡ç‰‡æ¶ˆæ¯",
  "description": "é£ä¹¦+jiaré›†æˆ SprintæŠ¥å‘Šå¡ç‰‡æ¶ˆæ¯",
  "keywords": [
    "Python"
  ],
  "articleBody": "èƒŒæ™¯ å½“å‰å…¬å¸ç ”å‘æµç¨‹å‡åœ¨jiraé¡¹ç›®ç®¡ç†å¹³å°æµè½¬ï¼Œæ¯2å‘¨ä¸€ä¸ªSprintå†²åˆºï¼ŒJiraä¸­ä¸å¸¦å…·ä½“çš„æ•°æ®ç»Ÿè®¡ä¸äººå‘˜åœ¨æ­¤Sprintä¸­çš„å®Œæˆåº¦ï¼Œæ¯æ¬¡Sprintå†²åˆºç»“æŸåæ— æ³•ç›´è§‚çš„çœ‹åˆ°äººå‘˜çš„æŠ•å…¥äº§å‡ºæ¯”ï¼Œäºæ˜¯å°±æƒ³åšä¸€ä¸ªJiraæ•°æ®æ”¶é›†ã€‚ç”±äºå…¬å¸é€šè®¯ä¸»è¦ä½¿ç”¨é£ä¹¦ï¼Œå°±ç»“åˆäº†é£ä¹¦å¡ç‰‡é€šçŸ¥å‘é€æ¶ˆæ¯ç»™åˆ°ç ”å‘ç¾¤ç»„ï¼Œä¾›å¤§å®¶å¯¹ä¸Šä¸€ä¸ªSprintçš„æŠ•å…¥äº§å‡ºä¸å®Œæˆçš„å·¥å•é‡è¿›è¡Œä¸€ä¸ªå¤ç›˜ã€‚\néœ€æ±‚åˆ†æ æ”¶é›†å½“å‰æ´»è·ƒçš„Sprintå†²åˆºä¸‹çš„æ‰€æœ‰å·¥å• ç»Ÿè®¡å·¥å•æ•°é‡ï¼Œå¹¶ä¸”ç»Ÿè®¡å·¥å•ç±»å‹ ç»Ÿè®¡äººå‘˜è´Ÿè´£å®Œæˆä¸æœªå®Œæˆå·¥å•æ•°é‡ä¸ç™¾åˆ†æ¯” ä½¿ç”¨é£ä¹¦æœºå™¨äººå‘é€é£ä¹¦å¡ç‰‡æ¶ˆæ¯ç»™åˆ°ç¾¤ç»„ éœ€æ±‚è°ƒç ” Jiraæ”¶é›†æ•°æ®æ–¹æ³• åœ¨pythonä¸­å¯ä»¥ä½¿ç”¨JIRAç¬¬ä¸‰æ–¹åº“å¯¹Jiraè¿›è¡Œæ“ä½œï¼Œé€šè¿‡GPTæˆ‘ä»¬å¯çŸ¥é“JIRAçš„å¯æ“ä½œæƒ…å†µ é€šè¿‡å›ç­”æˆ‘ä»¬å¯çŸ¥é“æ˜¯å¯ä»¥æ“ä½œSprintç®¡ç†ï¼Œç†Ÿæ‚‰JIRAè¿™ä¸ªåŒ…çš„çŸ¥é“ï¼ŒSprintç®¡ç†æ˜¯å¯ä»¥è·å–åˆ°å½“å‰Sprintæ‰€æœ‰å·¥å•çš„keyï¼Œé€šè¿‡keyå¯ä»¥è·å–åˆ°è¿™ä¸ªå·¥å•çš„è¯¦æƒ…ä¿¡æ¯ï¼Œæœ‰è´Ÿè´£äººã€å·¥å•ç±»å‹ã€ä¼˜å…ˆçº§ç­‰æ•°æ®ã€‚\nå¦‚ä½•å‘é€é£ä¹¦å¡ç‰‡æ¶ˆæ¯ é€šè¿‡é£ä¹¦åº”ç”¨æœºå™¨äººå¯è°ƒç”¨é£ä¹¦å¼€å‘APIå‘é€æ¶ˆæ¯æ¥å£ï¼Œæ­¤æ¥å£å¯å‘é€æ¶ˆæ¯å¡ç‰‡ç±»å‹çš„æ•°æ®ã€‚æ¶ˆæ¯å¡ç‰‡çš„æ•°æ®éœ€è¦åœ¨é£ä¹¦æ¶ˆæ¯å¡ç‰‡æ­å»ºä¸­è‡ªè¡Œæ­å»ºï¼Œç„¶åå¤åˆ¶å‡ºå¡ç‰‡æºä»£ç ç»™åˆ°æ¶ˆæ¯æ¥å£å‘é€å³å¯\né£ä¹¦å¡ç‰‡æ­å»ºåœ°å€ï¼šhttps://open.feishu.cn/cardkit\né£ä¹¦å‘é€æ¶ˆæ¯APIï¼šhttps://open.feishu.cn/document/ukTMukTMukTM/uYzM3QjL2MzN04iNzcDN/send-message-card/send-messages-using-card-json-data\næµç¨‹ç®€ä»‹ é€šè¿‡pythonè·å–jiraä¸­éœ€è¦çš„æ•°æ®ï¼Œé€šè¿‡pythonå¡«å……åˆ°å¡ç‰‡æºä»£ç ï¼Œè°ƒç”¨é£ä¹¦å‘é€æ¶ˆæ¯æ¥å£ï¼Œå‘é€æ¶ˆæ¯\nå®ç°æ­¥éª¤ jiraæ•°æ®æ”¶é›† jiraç™»å½• | jira_clent.py from jira import JIRA from units.get_config_data import get_config_yaml_data import jsonpath def get_jira_client(): json_data = get_config_yaml_data() server = jsonpath.jsonpath(json_data, \"$.jira.url\")[0] username = jsonpath.jsonpath(json_data, \"$.jira.username\")[0] password = jsonpath.jsonpath(json_data, \"$.jira.password\")[0] jira_cline = JIRA(server=server, basic_auth=(username, password)) return jira_cline if __name__ == '__main__': print(get_jira_client().search_issues( 'project = INET AND issuetype = æ•…éšœ AND status in (\"To Do\", å¼€å‘ä¸­) AND assignee in (awen.cheng)', maxResults=-1)) è·å–å½“å‰é¡¹ç›®æ´»è·ƒçš„Sprint | jira_sprint_msg.py #!/usr/bin/env python3.10.6 # -*- coding: utf-8 -*- # Author: Bobby Sheng import jsonpath import copy from units.get_config_data import get_config_yaml_data from units.jira_clent import get_jira_client from units.log_control import INFO, ERROR PROJECT_KEY = 'INET' EXCLUDED_SPRINT_ID = 61 def get_user_id(name_data): receive_id_data = jsonpath.jsonpath(get_config_yaml_data(), \"$.userInfo\")[0] receive_id = [i.get(\"user_id\") for i in receive_id_data if str(i.get(\"username\")) == str(name_data)][0] return receive_id def get_sprint_issues(project_key: str): \"\"\" è·å–é¡¹ç›®ä¸‹æ´»è·ƒçš„sprint :param project_key: é¡¹ç›®key :return: æ´»è·ƒsprintçš„IDï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°åˆ™è¿”å›None \"\"\" try: boards = get_jira_client().boards(projectKeyOrID=project_key) except Exception as e: ERROR.logger.error(f\"è·å–boardsæ—¶å‘ç”Ÿé”™è¯¯: {e}\") return None board_id = boards[0].id if boards else None if board_id: try: active_sprints = get_jira_client().sprints(board_id, state='active') except Exception as e: ERROR.logger.error(f\"è·å–sprintsæ—¶å‘ç”Ÿé”™è¯¯: {e}\") return None if not active_sprints: ERROR.logger.error(\"æ²¡æœ‰æ‰¾åˆ°æ´»è·ƒçš„sprintã€‚\") return None for sprint in active_sprints: if sprint.state == \"ACTIVE\" and sprint.id != EXCLUDED_SPRINT_ID: return sprint.id, sprint.name else: ERROR.logger.error(\"æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„æ´»è·ƒsprintã€‚\") return None def get_backlog_issues(project_key: str): \"\"\" è·å–é¡¹ç›®ä¸‹æŒ‡å®šsprintçš„backlog issues :param project_key: é¡¹ç›®key :return: \"\"\" sprint_info_list = [] try: sprint_id, sprint_name = get_sprint_issues(project_key) if not sprint_id: ERROR.logger.error(\"æ— æ³•è·å–sprint IDã€‚\") return # éªŒè¯project_keyå’Œsprint_idçš„æ ¼å¼ï¼Œè¿™é‡Œå‡è®¾å®ƒä»¬éƒ½æ˜¯ç¬¦åˆä¸€å®šè§„åˆ™çš„å­—ç¬¦ä¸² # è¿™ä¸ªéªŒè¯å¯ä»¥æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ if not isinstance(project_key, str) or not isinstance(sprint_id, int): ERROR.logger.error(\"é¡¹ç›®é”®æˆ–sprint IDæ ¼å¼ä¸æ­£ç¡®ã€‚\") return jql_str = f'project = {project_key} AND Sprint = {sprint_id} ORDER BY created DESC, ç­‰çº§ ASC' backlog_issues = get_jira_client().search_issues(jql_str, maxResults=1000) count = 1 for issue in backlog_issues: sprint_info = print_issue_info(issue) sprint_info_list.append(sprint_info) count += 1 INFO.logger.info(f\"å…±æ‰“å°äº† {count} ä¸ªäº‹åŠ¡ã€‚\") return sprint_info_list, sprint_name except Exception as e: ERROR.logger.error(f\"è·å–backlog issuesæ—¶å‘ç”Ÿé”™è¯¯: {e}\") def print_issue_info(issue): \"\"\" æ‰“å°issueä¿¡æ¯ \"\"\" sprint_info_data = { \"key\": issue.key, \"issue_type\": issue.fields.issuetype, \"summary\": issue.fields.summary, \"assignee\": issue.fields.assignee, \"reporter\": issue.fields.reporter, \"priority\": issue.fields.priority, \"status\": issue.fields.status, \"customfield_10106\": issue.fields.customfield_10106, } return sprint_info_data def job_completion_rate(sprint_info_list: list): if not isinstance(sprint_info_list, list): raise ValueError(\"è¾“å…¥å‚æ•°å¿…é¡»æ˜¯ä¸€ä¸ªåˆ—è¡¨\") story_list, story_list_done, story_list_fail = [], [], [] task_list, task_list_done, task_list_fail = [], [], [] bug_list, bug_list_done, bug_list_fail = [], [], [] completed_statuses = {\"å®Œæˆ\", \"æµ‹è¯•ä¸­\", \"æš‚ä¸å¤„ç†\", \"æµ‹è¯•é€šè¿‡\"} INFO.logger.info(f\"æ­£åœ¨è·å–é¡¹ç›®çš„sprint typeä¿¡æ¯...\") for i in sprint_info_list: if str(i.get(\"issue_type\")) == \"æ•…äº‹\": story_list.append(i) if str(i.get(\"status\")) in completed_statuses: story_list_done.append(i) else: story_list_fail.append(i) elif str(i.get(\"issue_type\")) == \"å­ä»»åŠ¡\": task_list.append(i) if str(i.get(\"status\")) in completed_statuses: task_list_done.append(i) else: task_list_fail.append(i) else: bug_list.append(i) if str(i.get(\"status\")) in completed_statuses: bug_list_done.append(i) else: bug_list_fail.append(i) all_done = len(bug_list_done) + len(task_list_done) + len(story_list_done) completion_rate = { \"len_story\": len(story_list), \"len_task\": len(task_list), \"len_bug\": len(bug_list), \"len_all\": len(sprint_info_list), \"story_handle\": { \"done\": len(story_list_done), \"fail\": len(story_list_fail), \"rate\": round((len(story_list_done) / len(story_list)) * 100, 2) }, \"task_handle\": { \"done\": len(task_list_done), \"fail\": len(task_list_fail), \"rate\": round((len(task_list_done) / len(task_list)) * 100, 2) }, \"bug_handle\": { \"done\": len(bug_list_done), \"fail\": len(bug_list_fail), \"rate\": round((len(bug_list_done) / len(bug_list)) * 100, 2) }, \"all_handle\": { \"done\": all_done, \"fail\": len(bug_list_fail) + len(task_list_fail) + len(story_list_fail), \"rate\": round((all_done / len(sprint_info_list)) * 100, 2) } } return completion_rate def user_msg_data(sprint_info_list: list): \"\"\" äººå‘˜çš„æ•°æ®ç»Ÿè®¡ï¼Œè¿”å›å¡ç‰‡çš„jsonæ•°æ® :param sprint_info_list: åŒ…å«ä»»åŠ¡ä¿¡æ¯çš„åˆ—è¡¨ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯å­—å…¸ç±»å‹ \"\"\" if not isinstance(sprint_info_list, list): raise ValueError(\"è¾“å…¥å‚æ•°å¿…é¡»æ˜¯ä¸€ä¸ªåˆ—è¡¨\") if not all(isinstance(item, dict) for item in sprint_info_list): raise ValueError(\"åˆ—è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½å¿…é¡»æ˜¯ä¸€ä¸ªå­—å…¸\") data_msg = {å¡ç‰‡ä¸­ä¸€åˆ—çš„ä»£ç ï¼Œæˆ‘è¿™é‡Œåšçš„æ˜¯å¾ªç¯å¡«å……ç”Ÿæˆçš„} #TODO issue_types = ['æ•…äº‹', 'æ•…éšœ', 'å­ä»»åŠ¡', 'ä»»åŠ¡', 'æ•…äº‹ç‚¹'] issue_status = [\"å®Œæˆ\", \"æµ‹è¯•ä¸­\", \"æš‚ä¸å¤„ç†\", \"æµ‹è¯•é€šè¿‡\", \"å¾…åŠ\", \"äº§å“éªŒæ”¶ä¸­\", \"å¼€å‘ä¸­\"] done_status = {\"å®Œæˆ\", \"æµ‹è¯•ä¸­\", \"æš‚ä¸å¤„ç†\", \"æµ‹è¯•é€šè¿‡\", \"äº§å“éªŒæ”¶ä¸­\"} issue_types_dones = ['æ•…äº‹å®Œæˆæ•°', 'æ•…éšœå®Œæˆæ•°', 'å­ä»»åŠ¡å®Œæˆæ•°', 'ä»»åŠ¡å®Œæˆæ•°'] type_counts = {t: 0 for t in issue_types} # åˆå§‹åŒ–è®¡æ•° status_counts = {t: 0 for t in issue_status} # åˆå§‹åŒ–è®¡æ•° issue_types_counts = {t: 0 for t in issue_types_dones} # åˆå§‹åŒ–è®¡æ•° user_counts = {} data_msg_list = [] for user_data in sprint_info_list: assignee = user_data.get(\"assignee\") if assignee is not None: if assignee not in user_counts: user_counts[assignee] = {'total': 0, **type_counts, **status_counts, **issue_types_counts} user_counts[assignee]['total'] += 1 if user_data.get('customfield_10106'): user_counts[assignee]['æ•…äº‹ç‚¹'] += float(user_data.get('customfield_10106')) for issue_type in issue_types: if str(user_data.get('issue_type')) == issue_type: user_counts[assignee][issue_type] += 1 for issue_statu in issue_status: if str(user_data.get('status')) == issue_statu: user_counts[assignee][issue_statu] += 1 for issue_types_done in issue_types_dones: issue_type_str = issue_types_done[:-3] if str(user_data.get('issue_type')) == issue_type_str and str(user_data.get('status')) in done_status: user_counts[assignee][issue_types_done] += 1 else: ERROR.logger.error(\"assigneeå­—æ®µä¸ºç©º\") # è¾“å‡ºç»“æœ one {'total': 22, 'æ•…äº‹': 6, 'æ•…éšœ': 6, 'å­ä»»åŠ¡': 10} for data_key, data_value in user_counts.items(): count = 0 for k, v in data_value.items(): if k in done_status: count += v # print(data_key, data_value, count) task_num = int(data_value.get('ä»»åŠ¡')) + int(data_value.get('å­ä»»åŠ¡')) done_task_num = int(data_value.get('å­ä»»åŠ¡å®Œæˆæ•°')) + int(data_value.get('ä»»åŠ¡å®Œæˆæ•°')) userid = get_user_id(data_key) data_msg_copy = copy.deepcopy(data_msg) data_msg_copy[\"columns\"][0][\"elements\"][0][\"persons\"][0][\"id\"] = userid data_msg_copy[\"columns\"][1][\"elements\"][0][\"columns\"][0][\"elements\"][0][\"text\"][ \"content\"] = f\"{data_value.get('æ•…äº‹å®Œæˆæ•°')}/{data_value.get('æ•…äº‹')}ä¸ª\" data_msg_copy[\"columns\"][2][\"elements\"][0][\"columns\"][0][\"elements\"][0][\"text\"][ \"content\"] = f\"{done_task_num}/{task_num}ä¸ª\" data_msg_copy[\"columns\"][3][\"elements\"][0][\"columns\"][0][\"elements\"][0][\"text\"][ \"content\"] = f\"{data_value.get('æ•…éšœå®Œæˆæ•°')}/{data_value.get('æ•…éšœ')}ä¸ª\" data_msg_copy[\"columns\"][4][\"elements\"][0][\"columns\"][0][\"elements\"][0][\"text\"][ \"content\"] = f\"{data_value.get('æ•…äº‹ç‚¹')}ä¸ª\" data_msg_copy[\"columns\"][5][\"elements\"][0][ \"content\"] = f\"({int(count)}/{int(data_value.get('total'))}) {round((int(count) / int(data_value.get('total'))) * 100, 2)}%\" data_msg_list.append(data_msg_copy) return data_msg_list é£ä¹¦APIå‘é€ é£ä¹¦APIè®¤è¯ #!/usr/bin/env python3.10.6 # -*- coding: utf-8 -*- # Author: Bobby Sheng from units.get_config_data import get_config_yaml_data import requests import jsonpath Config = get_config_yaml_data() def tenant_access_token(): \"\"\"è·å–å¼•ç”¨tenant_access_token :return: tenant_access_token \"\"\" data = {\"app_id\": jsonpath.jsonpath(Config, \"$.feishu.app_id\")[0], \"app_secret\": jsonpath.jsonpath(Config, \"$.feishu.app_secret\")[0]} res = requests.post(jsonpath.jsonpath(Config, \"$.feishu.webhook_token\")[0], data=data).json() headers = { 'Content-Type': 'application/json', 'Authorization': \"Bearer \" + res[\"app_access_token\"] } return headers é£ä¹¦å¡ç‰‡æ¶ˆæ¯å‘é€ #!/usr/bin/env python3.10.6 # -*- coding: utf-8 -*- # Author: Bobby Sheng import requests import json import time import jsonpath from units.get_config_data import get_config_yaml_data from units.log_control import INFO from feushu_api.feishu_login import tenant_access_token from jira_business.jira_sprint_msg import user_msg_data, get_backlog_issues, job_completion_rate data_msg = {å¡ç‰‡æºä»£ç } #TODO # ${sprint} ${ALL} ${story_all} ${bug_all} ${task_all} ${story_fail} ${story_done} ${story_rate} ${bug_fail} ${bug_done} ${bug_rate} # ${task_fail} ${task_done} ${task_rate} ${all_fail} ${all_done} ${all_rate} def send_sprint_msg(): sprint_info_list, sprint_name = get_backlog_issues('INET') # # å¼€å‘è€…æ•°æ®ç»Ÿè®¡ data_msg_list = user_msg_data(sprint_info_list) c.get(\"i18n_elements\").get('zh_cn').extend(data_msg_list) # å·¥å•æ•°æ®ç»Ÿè®¡ job_data = job_completion_rate(sprint_info_list) c1 = json.dumps(c).replace(\"${sprint}\", sprint_name).replace(\"${ALL}\", str(job_data[\"len_all\"])).replace( \"${story_all}\", str(job_data[ \"len_story\"])) \\ .replace(\"${bug_all}\", str(job_data[\"len_bug\"])).replace(\"${task_all}\", str(job_data[\"len_task\"])). \\ replace(\"${story_fail}\", str(job_data[\"story_handle\"][\"fail\"])).replace(\"${story_done}\", str(job_data[\"story_handle\"][\"done\"])). \\ replace(\"${story_rate}\", str(job_data[\"story_handle\"][\"rate\"])).replace(\"${bug_fail}\", str(job_data[\"bug_handle\"][\"fail\"])). \\ replace(\"${bug_done}\", str(job_data[\"bug_handle\"][\"done\"])).replace(\"${bug_rate}\", str(job_data[\"bug_handle\"][\"rate\"])). \\ replace(\"${task_fail}\", str(job_data[\"task_handle\"][\"fail\"])).replace(\"${task_done}\", str(job_data[\"task_handle\"][\"done\"])). \\ replace(\"${task_rate}\", str(job_data[\"task_handle\"][\"rate\"])).replace(\"${all_fail}\", str(job_data[\"all_handle\"][\"fail\"])). \\ replace(\"${all_done}\", str(job_data[\"all_handle\"][\"done\"])).replace(\"${all_rate}\", str(job_data[\"all_handle\"][\"rate\"])) headers = tenant_access_token() rich_text = { \"receive_id\": \"6b9eab87\", \"msg_type\": \"interactive\", \"content\": c1 } # oc_17703b85be608b568b1fed1c3a2f3110 æµ‹è¯•ç¾¤ # oc_672137dedd6b9104cdf1d99d5bdea47a ç ”å‘ç¾¤ INFO.logger.info(f\"æ¶ˆæ¯æ¥å—è€…ï¼š6b9eab87\") post_data = json.dumps(rich_text) response = requests.post( jsonpath.jsonpath(get_config_yaml_data(), \"$.feishu.webhook\")[0], headers=headers, data=post_data, verify=False ) result = response.json() INFO.logger.info(f\"å‘é€æ¶ˆæ¯æ¥è¿”å›{result}\") if result.get('code') != 0: time_now = time.strftime(\"%Y-%m-%d %H:%M:%S\", time.localtime(time.time())) result_msg = result['errmsg'] if result.get('errmsg', False) else 'æœªçŸ¥å¼‚å¸¸' error_data = { \"msgtype\": \"text\", \"text\": { \"content\": f\"[æ³¨æ„-è‡ªåŠ¨é€šçŸ¥]é£ä¹¦æœºå™¨äººæ¶ˆæ¯å‘é€å¤±è´¥ï¼Œæ—¶é—´ï¼š{time_now}ï¼Œ\" f\"åŸå› ï¼š{result_msg}ï¼Œè¯·åŠæ—¶è·Ÿè¿›ï¼Œè°¢è°¢!\" }, \"at\": { \"isAtAll\": False } } INFO.logger.error(\"æ¶ˆæ¯å‘é€å¤±è´¥ï¼Œè‡ªåŠ¨é€šçŸ¥ï¼š%s\", error_data) requests.post(jsonpath.jsonpath(get_config_yaml_data(), \"$.feishu.webhook\")[0], headers=headers, data=json.dumps(error_data)) if __name__ == '__main__': send_sprint_msg() ä»£ç ç»“æ„ æ•ˆæœå±•ç¤º æ€»ç»“ ç©ºé—²æ—¶é—´ç¼–å†™ï¼Œæ²¡å¤ªå¤šæ—¶é—´å»æ„æ€ä»£ç è®¾è®¡ï¼Œä¸»è¦ä»¥å®ç°åŠŸèƒ½ä¸ºä¸»ï¼Œä»£ç å†™çš„ç®€å•ç²—æš´ã€‚æ›´å¤šçš„æ˜¯æä¾›ä¸€ç§æ€è·¯ã€‚\n",
  "wordCount" : "3635",
  "inLanguage": "en",
  "image":"https://telegraph-image-f19.pages.dev/file/cf7de6d9cd14daa933b2b.jpg","datePublished": "2024-05-16T00:00:00Z",
  "dateModified": "2024-05-16T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Bobby"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://bobby-sheng.github.io/BobbySheng/en/posts/blog/%E9%A3%9E%E4%B9%A6+jiar%E9%9B%86%E6%88%90sprint%E6%8A%A5%E5%91%8A%E5%8D%A1%E7%89%87%E6%B6%88%E6%81%AF/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Bobby Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://bobby-sheng.github.io/BobbySheng/img/title.png"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://bobby-sheng.github.io/BobbySheng/en/" accesskey="h" title="Bobby Blog (Alt + H)">
                <img src="https://bobby-sheng.github.io/BobbySheng/img/title.png" alt="" aria-label="logo"
                    height="35">Bobby Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                </ul>
            </div>
        </div>
        <ul id="menu">
            <li class="menu-item">
                <a href="https://bobby-sheng.github.io/BobbySheng/en/search" title="ğŸ” Search (Alt &#43; /)" accesskey=/>
                    <span>ğŸ” Search</span>
                    
                </a>
            
            </li>
            <li class="menu-item">
                <a href="https://bobby-sheng.github.io/BobbySheng/en/posts" title="ğŸ“œ Blog">
                    <span>ğŸ“œ Blog</span>
                    
                </a>
            
            </li>
            <li class="menu-item">
                <a href="https://bobby-sheng.github.io/BobbySheng/en/archives" title="ğŸ’¾ History">
                    <span>ğŸ’¾ History</span>
                    
                </a>
            
            </li>
            <li class="menu-item">
                <a href="https://bobby-sheng.github.io/BobbySheng/en/about" title="ğŸ™‹ğŸ»â€â™‚ï¸ About">
                    <span>ğŸ™‹ğŸ»â€â™‚ï¸ About</span>
                    
                </a>
            
            </li>
        </ul>
    </nav>
</header>
<main class="main page">
<article class="post-single">
    <div id="single-content">
        <header class="post-header">
            <div class="breadcrumbs"><a href="https://bobby-sheng.github.io/BobbySheng/en/">Home</a>&nbsp;Â»&nbsp;<a href="https://bobby-sheng.github.io/BobbySheng/en/posts/">âŒ› Thought</a>&nbsp;Â»&nbsp;<a href="https://bobby-sheng.github.io/BobbySheng/en/posts/blog/">ğŸ—ï¸ Blog</a></div>
            <h1 class="post-title">
                é£ä¹¦&#43;jiaré›†æˆ|SprintæŠ¥å‘Šå¡ç‰‡æ¶ˆæ¯
            </h1>
            <div class="post-description">
                é£ä¹¦&#43;jiaré›†æˆ SprintæŠ¥å‘Šå¡ç‰‡æ¶ˆæ¯
            </div>
            <div class="post-meta">

<style>
    i[id*="post_meta_style"] {
        display: flex;
        align-items: center;
        margin: 0 0 10px 0;
    }

    .parent-post-meta {
        display: flex;
        flex-wrap: wrap;
        opacity: 0.8;
    }
</style>

<span class="parent-post-meta">
    <span id="post_meta_style_1">
        <span class="fa fa-calendar-check-o"></span>
        <span>2024-05-16
            &nbsp;&nbsp;
        </span>
    </span>
    
    
    
    
    
    
    
    <span id="post_meta_style_3">
        <span class="fa fa-file-word-o"></span>
        <span>3635 Char
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_4">
        <span class="fa fa-clock-o"></span>
        <span>8 min
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_5">
        <span class="fa fa-user-o"></span>
        <span>Author:&nbsp;Bobby
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_6">
        <span class="fa fa-tags" style="opacity: 0.8"></span>
        <span>
            <span class="post-tags-meta">
                Tags:
                <a href="https://bobby-sheng.github.io/BobbySheng/en/tags/python/" style="color: var(--secondary)!important;">Python</a>
            </span>
        </span>
    </span>
</span>
<span style="opacity: 0.8;">
                    <span id="post_meta_style_7">
                        &nbsp;&nbsp;
                        <span class="fa fa-eye" ></span>
                        <span>
                            Visit:<span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv"></span></span>
                            &nbsp;&nbsp;
                        </span>
                    </span>
                    <span id="post_meta_style_8">
                        <span class="fa fa-commenting-o"></span>
                        <span>
                            <script src="https://cdn.staticfile.org/twikoo/1.6.15/twikoo.all.min.js"></script>
                            <script>
                                let url = document.documentURI
                                
                                let dnsUrl = "https://bobby-sheng.github.io/BobbySheng/"
                                let urlSplit = url.split(dnsUrl)
                                let finalUrl = urlSplit[1]
                                if (finalUrl[0] !== '/') {
                                    finalUrl = '/'+finalUrl
                                }
                                twikoo.getCommentsCount({
                                    envId:  null , 
                                region:  null , 
                                urls: [ 
                                    
                                    finalUrl,
                                ],
                                    includeReply: false 
                                }).then(function (res) {
                                    let count = res[0].count
                                    const obj = document.getElementById("comment_count");
                                    obj.innerText = count
                                    
                                    
                                    
                                }).catch(function (err) {
                                    
                                    console.error(err);
                                });
                            </script>
                            <span id="comment_count"></span>
                        </span>
                    </span>
                </span>

</div>
        </header> <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Catalogue</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e8%83%8c%e6%99%af" aria-label="èƒŒæ™¯">èƒŒæ™¯</a></li>
                <li>
                    <a href="#%e9%9c%80%e6%b1%82%e5%88%86%e6%9e%90" aria-label="éœ€æ±‚åˆ†æ">éœ€æ±‚åˆ†æ</a></li>
                <li>
                    <a href="#%e9%9c%80%e6%b1%82%e8%b0%83%e7%a0%94" aria-label="éœ€æ±‚è°ƒç ”">éœ€æ±‚è°ƒç ”</a><ul>
                        
                <li>
                    <a href="#jira%e6%94%b6%e9%9b%86%e6%95%b0%e6%8d%ae%e6%96%b9%e6%b3%95" aria-label="Jiraæ”¶é›†æ•°æ®æ–¹æ³•">Jiraæ”¶é›†æ•°æ®æ–¹æ³•</a></li>
                <li>
                    <a href="#%e5%a6%82%e4%bd%95%e5%8f%91%e9%80%81%e9%a3%9e%e4%b9%a6%e5%8d%a1%e7%89%87%e6%b6%88%e6%81%af" aria-label="å¦‚ä½•å‘é€é£ä¹¦å¡ç‰‡æ¶ˆæ¯">å¦‚ä½•å‘é€é£ä¹¦å¡ç‰‡æ¶ˆæ¯</a></li>
                <li>
                    <a href="#%e6%b5%81%e7%a8%8b%e7%ae%80%e4%bb%8b" aria-label="æµç¨‹ç®€ä»‹">æµç¨‹ç®€ä»‹</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%ae%9e%e7%8e%b0%e6%ad%a5%e9%aa%a4" aria-label="å®ç°æ­¥éª¤">å®ç°æ­¥éª¤</a><ul>
                        
                <li>
                    <a href="#jira%e6%95%b0%e6%8d%ae%e6%94%b6%e9%9b%86" aria-label="jiraæ•°æ®æ”¶é›†">jiraæ•°æ®æ”¶é›†</a></li>
                <li>
                    <a href="#%e9%a3%9e%e4%b9%a6api%e5%8f%91%e9%80%81" aria-label="é£ä¹¦APIå‘é€">é£ä¹¦APIå‘é€</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%95%88%e6%9e%9c%e5%b1%95%e7%a4%ba" aria-label="æ•ˆæœå±•ç¤º">æ•ˆæœå±•ç¤º</a></li>
                <li>
                    <a href="#%e6%80%bb%e7%bb%93" aria-label="æ€»ç»“">æ€»ç»“</a>
                </li>
            </ul>
        </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
        
        activeElement = elements[0];
        const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
        document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
    }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 &&
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
            const id = encodeURI(element.getAttribute('id')).toLowerCase();
            if (element === activeElement){
                document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
            } else {
                document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
            }
        })
    }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;
        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;
    }
</script>
        <div class="post-content"><h1 id="èƒŒæ™¯">èƒŒæ™¯<a hidden class="anchor" aria-hidden="true" href="#èƒŒæ™¯">#</a></h1>
<p>å½“å‰å…¬å¸ç ”å‘æµç¨‹å‡åœ¨jiraé¡¹ç›®ç®¡ç†å¹³å°æµè½¬ï¼Œæ¯2å‘¨ä¸€ä¸ªSprintå†²åˆºï¼ŒJiraä¸­ä¸å¸¦å…·ä½“çš„æ•°æ®ç»Ÿè®¡ä¸äººå‘˜åœ¨æ­¤Sprintä¸­çš„å®Œæˆåº¦ï¼Œæ¯æ¬¡Sprintå†²åˆºç»“æŸåæ— æ³•ç›´è§‚çš„çœ‹åˆ°äººå‘˜çš„æŠ•å…¥äº§å‡ºæ¯”ï¼Œäºæ˜¯å°±æƒ³åšä¸€ä¸ªJiraæ•°æ®æ”¶é›†ã€‚ç”±äºå…¬å¸é€šè®¯ä¸»è¦ä½¿ç”¨é£ä¹¦ï¼Œå°±ç»“åˆäº†é£ä¹¦å¡ç‰‡é€šçŸ¥å‘é€æ¶ˆæ¯ç»™åˆ°ç ”å‘ç¾¤ç»„ï¼Œä¾›å¤§å®¶å¯¹ä¸Šä¸€ä¸ªSprintçš„æŠ•å…¥äº§å‡ºä¸å®Œæˆçš„å·¥å•é‡è¿›è¡Œä¸€ä¸ªå¤ç›˜ã€‚</p>
<h1 id="éœ€æ±‚åˆ†æ">éœ€æ±‚åˆ†æ<a hidden class="anchor" aria-hidden="true" href="#éœ€æ±‚åˆ†æ">#</a></h1>
<ol>
<li>æ”¶é›†å½“å‰æ´»è·ƒçš„Sprintå†²åˆºä¸‹çš„æ‰€æœ‰å·¥å•</li>
<li>ç»Ÿè®¡å·¥å•æ•°é‡ï¼Œå¹¶ä¸”ç»Ÿè®¡å·¥å•ç±»å‹</li>
<li>ç»Ÿè®¡äººå‘˜è´Ÿè´£å®Œæˆä¸æœªå®Œæˆå·¥å•æ•°é‡ä¸ç™¾åˆ†æ¯”</li>
<li>ä½¿ç”¨é£ä¹¦æœºå™¨äººå‘é€é£ä¹¦å¡ç‰‡æ¶ˆæ¯ç»™åˆ°ç¾¤ç»„</li>
</ol>
<h1 id="éœ€æ±‚è°ƒç ”">éœ€æ±‚è°ƒç ”<a hidden class="anchor" aria-hidden="true" href="#éœ€æ±‚è°ƒç ”">#</a></h1>
<h2 id="jiraæ”¶é›†æ•°æ®æ–¹æ³•">Jiraæ”¶é›†æ•°æ®æ–¹æ³•<a hidden class="anchor" aria-hidden="true" href="#jiraæ”¶é›†æ•°æ®æ–¹æ³•">#</a></h2>
<p>åœ¨pythonä¸­å¯ä»¥ä½¿ç”¨JIRAç¬¬ä¸‰æ–¹åº“å¯¹Jiraè¿›è¡Œæ“ä½œï¼Œé€šè¿‡GPTæˆ‘ä»¬å¯çŸ¥é“JIRAçš„å¯æ“ä½œæƒ…å†µ
<img loading="lazy" src="https://telegraph-image-f19.pages.dev/file/472eecc6bddf8d73c5e2d.jpg" alt="img.png"  />

é€šè¿‡å›ç­”æˆ‘ä»¬å¯çŸ¥é“æ˜¯å¯ä»¥æ“ä½œSprintç®¡ç†ï¼Œç†Ÿæ‚‰JIRAè¿™ä¸ªåŒ…çš„çŸ¥é“ï¼ŒSprintç®¡ç†æ˜¯å¯ä»¥è·å–åˆ°å½“å‰Sprintæ‰€æœ‰å·¥å•çš„keyï¼Œé€šè¿‡keyå¯ä»¥è·å–åˆ°è¿™ä¸ªå·¥å•çš„è¯¦æƒ…ä¿¡æ¯ï¼Œæœ‰è´Ÿè´£äººã€å·¥å•ç±»å‹ã€ä¼˜å…ˆçº§ç­‰æ•°æ®ã€‚</p>
<h2 id="å¦‚ä½•å‘é€é£ä¹¦å¡ç‰‡æ¶ˆæ¯">å¦‚ä½•å‘é€é£ä¹¦å¡ç‰‡æ¶ˆæ¯<a hidden class="anchor" aria-hidden="true" href="#å¦‚ä½•å‘é€é£ä¹¦å¡ç‰‡æ¶ˆæ¯">#</a></h2>
<p>é€šè¿‡é£ä¹¦åº”ç”¨æœºå™¨äººå¯è°ƒç”¨é£ä¹¦å¼€å‘APIå‘é€æ¶ˆæ¯æ¥å£ï¼Œæ­¤æ¥å£å¯å‘é€æ¶ˆæ¯å¡ç‰‡ç±»å‹çš„æ•°æ®ã€‚æ¶ˆæ¯å¡ç‰‡çš„æ•°æ®éœ€è¦åœ¨é£ä¹¦æ¶ˆæ¯å¡ç‰‡æ­å»ºä¸­è‡ªè¡Œæ­å»ºï¼Œç„¶åå¤åˆ¶å‡ºå¡ç‰‡æºä»£ç ç»™åˆ°æ¶ˆæ¯æ¥å£å‘é€å³å¯</p>
<p>é£ä¹¦å¡ç‰‡æ­å»ºåœ°å€ï¼šhttps://open.feishu.cn/cardkit</p>
<p><img loading="lazy" src="https://telegraph-image-f19.pages.dev/file/603769e1621bcd6844ab2.jpg" alt="img.png"  />

é£ä¹¦å‘é€æ¶ˆæ¯APIï¼šhttps://open.feishu.cn/document/ukTMukTMukTM/uYzM3QjL2MzN04iNzcDN/send-message-card/send-messages-using-card-json-data</p>
<p><img loading="lazy" src="https://telegraph-image-f19.pages.dev/file/555de68e046adab04b903.jpg" alt="img.png"  />
</p>
<h2 id="æµç¨‹ç®€ä»‹">æµç¨‹ç®€ä»‹<a hidden class="anchor" aria-hidden="true" href="#æµç¨‹ç®€ä»‹">#</a></h2>
<p>é€šè¿‡pythonè·å–jiraä¸­éœ€è¦çš„æ•°æ®ï¼Œé€šè¿‡pythonå¡«å……åˆ°å¡ç‰‡æºä»£ç ï¼Œè°ƒç”¨é£ä¹¦å‘é€æ¶ˆæ¯æ¥å£ï¼Œå‘é€æ¶ˆæ¯</p>
<h1 id="å®ç°æ­¥éª¤">å®ç°æ­¥éª¤<a hidden class="anchor" aria-hidden="true" href="#å®ç°æ­¥éª¤">#</a></h1>
<h2 id="jiraæ•°æ®æ”¶é›†">jiraæ•°æ®æ”¶é›†<a hidden class="anchor" aria-hidden="true" href="#jiraæ•°æ®æ”¶é›†">#</a></h2>
<ol>
<li>jiraç™»å½• | jira_clent.py</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Bash" data-lang="Bash"><span style="display:flex;"><span>from jira import JIRA
</span></span><span style="display:flex;"><span>from units.get_config_data import get_config_yaml_data
</span></span><span style="display:flex;"><span>import jsonpath
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>def get_jira_client<span style="color:#5bc4bf">()</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ef6155">json_data</span> <span style="color:#5bc4bf">=</span> get_config_yaml_data<span style="color:#5bc4bf">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ef6155">server</span> <span style="color:#5bc4bf">=</span> jsonpath.jsonpath<span style="color:#5bc4bf">(</span>json_data, <span style="color:#48b685">&#34;</span>$<span style="color:#48b685">.jira.url&#34;</span><span style="color:#5bc4bf">)[</span>0<span style="color:#5bc4bf">]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ef6155">username</span> <span style="color:#5bc4bf">=</span> jsonpath.jsonpath<span style="color:#5bc4bf">(</span>json_data, <span style="color:#48b685">&#34;</span>$<span style="color:#48b685">.jira.username&#34;</span><span style="color:#5bc4bf">)[</span>0<span style="color:#5bc4bf">]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ef6155">password</span> <span style="color:#5bc4bf">=</span> jsonpath.jsonpath<span style="color:#5bc4bf">(</span>json_data, <span style="color:#48b685">&#34;</span>$<span style="color:#48b685">.jira.password&#34;</span><span style="color:#5bc4bf">)[</span>0<span style="color:#5bc4bf">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ef6155">jira_cline</span> <span style="color:#5bc4bf">=</span> JIRA<span style="color:#5bc4bf">(</span><span style="color:#ef6155">server</span><span style="color:#5bc4bf">=</span>server, <span style="color:#ef6155">basic_auth</span><span style="color:#5bc4bf">=(</span>username, password<span style="color:#5bc4bf">))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#815ba4">return</span> jira_cline
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#815ba4">if</span> <span style="color:#ef6155">__name__</span> <span style="color:#5bc4bf">==</span> <span style="color:#48b685">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    print<span style="color:#5bc4bf">(</span>get_jira_client<span style="color:#5bc4bf">()</span>.search_issues<span style="color:#5bc4bf">(</span>
</span></span><span style="display:flex;"><span>        <span style="color:#48b685">&#39;project = INET AND issuetype = æ•…éšœ AND status in (&#34;To Do&#34;, å¼€å‘ä¸­) AND assignee in (awen.cheng)&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ef6155">maxResults</span><span style="color:#5bc4bf">=</span>-1<span style="color:#5bc4bf">))</span>
</span></span></code></pre></div><ol>
<li>è·å–å½“å‰é¡¹ç›®æ´»è·ƒçš„Sprint | jira_sprint_msg.py</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Bash" data-lang="Bash"><span style="display:flex;"><span><span style="color:#776e71">#!/usr/bin/env python3.10.6
</span></span></span><span style="display:flex;"><span><span style="color:#776e71"></span><span style="color:#776e71"># -*- coding: utf-8 -*-</span>
</span></span><span style="display:flex;"><span><span style="color:#776e71"># Author: Bobby Sheng &lt;Bobby@sky-cloud.net&gt;</span>
</span></span><span style="display:flex;"><span>import jsonpath
</span></span><span style="display:flex;"><span>import copy
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>from units.get_config_data import get_config_yaml_data
</span></span><span style="display:flex;"><span>from units.jira_clent import get_jira_client
</span></span><span style="display:flex;"><span>from units.log_control import INFO, ERROR
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ef6155">PROJECT_KEY</span> <span style="color:#5bc4bf">=</span> <span style="color:#48b685">&#39;INET&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#ef6155">EXCLUDED_SPRINT_ID</span> <span style="color:#5bc4bf">=</span> <span style="color:#f99b15">61</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>def get_user_id<span style="color:#5bc4bf">(</span>name_data<span style="color:#5bc4bf">)</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ef6155">receive_id_data</span> <span style="color:#5bc4bf">=</span> jsonpath.jsonpath<span style="color:#5bc4bf">(</span>get_config_yaml_data<span style="color:#5bc4bf">()</span>, <span style="color:#48b685">&#34;</span>$<span style="color:#48b685">.userInfo&#34;</span><span style="color:#5bc4bf">)[</span>0<span style="color:#5bc4bf">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ef6155">receive_id</span> <span style="color:#5bc4bf">=</span> <span style="color:#5bc4bf">[</span>i.get<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#34;user_id&#34;</span><span style="color:#5bc4bf">)</span> <span style="color:#815ba4">for</span> i in receive_id_data <span style="color:#815ba4">if</span> str<span style="color:#5bc4bf">(</span>i.get<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#34;username&#34;</span><span style="color:#5bc4bf">))</span> <span style="color:#5bc4bf">==</span> str<span style="color:#5bc4bf">(</span>name_data<span style="color:#5bc4bf">)][</span>0<span style="color:#5bc4bf">]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#815ba4">return</span> receive_id
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>def get_sprint_issues<span style="color:#5bc4bf">(</span>project_key: str<span style="color:#5bc4bf">)</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#48b685">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">    è·å–é¡¹ç›®ä¸‹æ´»è·ƒçš„sprint
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">    :param project_key: é¡¹ç›®key
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">    :return: æ´»è·ƒsprintçš„IDï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°åˆ™è¿”å›None
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    try:
</span></span><span style="display:flex;"><span>        <span style="color:#ef6155">boards</span> <span style="color:#5bc4bf">=</span> get_jira_client<span style="color:#5bc4bf">()</span>.boards<span style="color:#5bc4bf">(</span><span style="color:#ef6155">projectKeyOrID</span><span style="color:#5bc4bf">=</span>project_key<span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>    except Exception as e:
</span></span><span style="display:flex;"><span>        ERROR.logger.error<span style="color:#5bc4bf">(</span>f<span style="color:#48b685">&#34;è·å–boardsæ—¶å‘ç”Ÿé”™è¯¯: {e}&#34;</span><span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#815ba4">return</span> None
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ef6155">board_id</span> <span style="color:#5bc4bf">=</span> boards<span style="color:#5bc4bf">[</span>0<span style="color:#5bc4bf">]</span>.id <span style="color:#815ba4">if</span> boards <span style="color:#815ba4">else</span> None
</span></span><span style="display:flex;"><span>    <span style="color:#815ba4">if</span> board_id:
</span></span><span style="display:flex;"><span>        try:
</span></span><span style="display:flex;"><span>            <span style="color:#ef6155">active_sprints</span> <span style="color:#5bc4bf">=</span> get_jira_client<span style="color:#5bc4bf">()</span>.sprints<span style="color:#5bc4bf">(</span>board_id, <span style="color:#ef6155">state</span><span style="color:#5bc4bf">=</span><span style="color:#48b685">&#39;active&#39;</span><span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>        except Exception as e:
</span></span><span style="display:flex;"><span>            ERROR.logger.error<span style="color:#5bc4bf">(</span>f<span style="color:#48b685">&#34;è·å–sprintsæ—¶å‘ç”Ÿé”™è¯¯: {e}&#34;</span><span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#815ba4">return</span> None
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#815ba4">if</span> not active_sprints:
</span></span><span style="display:flex;"><span>            ERROR.logger.error<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#34;æ²¡æœ‰æ‰¾åˆ°æ´»è·ƒçš„sprintã€‚&#34;</span><span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#815ba4">return</span> None
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#815ba4">for</span> sprint in active_sprints:
</span></span><span style="display:flex;"><span>            <span style="color:#815ba4">if</span> sprint.state <span style="color:#5bc4bf">==</span> <span style="color:#48b685">&#34;ACTIVE&#34;</span> and sprint.id !<span style="color:#5bc4bf">=</span> EXCLUDED_SPRINT_ID:
</span></span><span style="display:flex;"><span>                <span style="color:#815ba4">return</span> sprint.id, sprint.name
</span></span><span style="display:flex;"><span>    <span style="color:#815ba4">else</span>:
</span></span><span style="display:flex;"><span>        ERROR.logger.error<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#34;æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„æ´»è·ƒsprintã€‚&#34;</span><span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#815ba4">return</span> None
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>def get_backlog_issues<span style="color:#5bc4bf">(</span>project_key: str<span style="color:#5bc4bf">)</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#48b685">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">    è·å–é¡¹ç›®ä¸‹æŒ‡å®šsprintçš„backlog issues
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">    :param project_key: é¡¹ç›®key
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">    :return:
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ef6155">sprint_info_list</span> <span style="color:#5bc4bf">=</span> <span style="color:#5bc4bf">[]</span>
</span></span><span style="display:flex;"><span>    try:
</span></span><span style="display:flex;"><span>        sprint_id, <span style="color:#ef6155">sprint_name</span> <span style="color:#5bc4bf">=</span> get_sprint_issues<span style="color:#5bc4bf">(</span>project_key<span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#815ba4">if</span> not sprint_id:
</span></span><span style="display:flex;"><span>            ERROR.logger.error<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#34;æ— æ³•è·å–sprint IDã€‚&#34;</span><span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#815ba4">return</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#776e71"># éªŒè¯project_keyå’Œsprint_idçš„æ ¼å¼ï¼Œè¿™é‡Œå‡è®¾å®ƒä»¬éƒ½æ˜¯ç¬¦åˆä¸€å®šè§„åˆ™çš„å­—ç¬¦ä¸²</span>
</span></span><span style="display:flex;"><span>        <span style="color:#776e71"># è¿™ä¸ªéªŒè¯å¯ä»¥æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´</span>
</span></span><span style="display:flex;"><span>        <span style="color:#815ba4">if</span> not isinstance<span style="color:#5bc4bf">(</span>project_key, str<span style="color:#5bc4bf">)</span> or not isinstance<span style="color:#5bc4bf">(</span>sprint_id, int<span style="color:#5bc4bf">)</span>:
</span></span><span style="display:flex;"><span>            ERROR.logger.error<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#34;é¡¹ç›®é”®æˆ–sprint IDæ ¼å¼ä¸æ­£ç¡®ã€‚&#34;</span><span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#815ba4">return</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ef6155">jql_str</span> <span style="color:#5bc4bf">=</span> f<span style="color:#48b685">&#39;project = {project_key} AND Sprint = {sprint_id} ORDER BY created DESC, ç­‰çº§ ASC&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ef6155">backlog_issues</span> <span style="color:#5bc4bf">=</span> get_jira_client<span style="color:#5bc4bf">()</span>.search_issues<span style="color:#5bc4bf">(</span>jql_str, <span style="color:#ef6155">maxResults</span><span style="color:#5bc4bf">=</span>1000<span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ef6155">count</span> <span style="color:#5bc4bf">=</span> <span style="color:#f99b15">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#815ba4">for</span> issue in backlog_issues:
</span></span><span style="display:flex;"><span>            <span style="color:#ef6155">sprint_info</span> <span style="color:#5bc4bf">=</span> print_issue_info<span style="color:#5bc4bf">(</span>issue<span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>            sprint_info_list.append<span style="color:#5bc4bf">(</span>sprint_info<span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ef6155">count</span> <span style="color:#5bc4bf">+=</span> <span style="color:#f99b15">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        INFO.logger.info<span style="color:#5bc4bf">(</span>f<span style="color:#48b685">&#34;å…±æ‰“å°äº† {count} ä¸ªäº‹åŠ¡ã€‚&#34;</span><span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#815ba4">return</span> sprint_info_list, sprint_name
</span></span><span style="display:flex;"><span>    except Exception as e:
</span></span><span style="display:flex;"><span>        ERROR.logger.error<span style="color:#5bc4bf">(</span>f<span style="color:#48b685">&#34;è·å–backlog issuesæ—¶å‘ç”Ÿé”™è¯¯: {e}&#34;</span><span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>def print_issue_info<span style="color:#5bc4bf">(</span>issue<span style="color:#5bc4bf">)</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#48b685">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">    æ‰“å°issueä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ef6155">sprint_info_data</span> <span style="color:#5bc4bf">=</span> <span style="color:#5bc4bf">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#48b685">&#34;key&#34;</span>: issue.key,
</span></span><span style="display:flex;"><span>        <span style="color:#48b685">&#34;issue_type&#34;</span>: issue.fields.issuetype,
</span></span><span style="display:flex;"><span>        <span style="color:#48b685">&#34;summary&#34;</span>: issue.fields.summary,
</span></span><span style="display:flex;"><span>        <span style="color:#48b685">&#34;assignee&#34;</span>: issue.fields.assignee,
</span></span><span style="display:flex;"><span>        <span style="color:#48b685">&#34;reporter&#34;</span>: issue.fields.reporter,
</span></span><span style="display:flex;"><span>        <span style="color:#48b685">&#34;priority&#34;</span>: issue.fields.priority,
</span></span><span style="display:flex;"><span>        <span style="color:#48b685">&#34;status&#34;</span>: issue.fields.status,
</span></span><span style="display:flex;"><span>        <span style="color:#48b685">&#34;customfield_10106&#34;</span>: issue.fields.customfield_10106,
</span></span><span style="display:flex;"><span>    <span style="color:#5bc4bf">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#815ba4">return</span> sprint_info_data
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>def job_completion_rate<span style="color:#5bc4bf">(</span>sprint_info_list: list<span style="color:#5bc4bf">)</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#815ba4">if</span> not isinstance<span style="color:#5bc4bf">(</span>sprint_info_list, list<span style="color:#5bc4bf">)</span>:
</span></span><span style="display:flex;"><span>        raise ValueError<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#34;è¾“å…¥å‚æ•°å¿…é¡»æ˜¯ä¸€ä¸ªåˆ—è¡¨&#34;</span><span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>    story_list, story_list_done, <span style="color:#ef6155">story_list_fail</span> <span style="color:#5bc4bf">=</span> <span style="color:#5bc4bf">[]</span>, <span style="color:#5bc4bf">[]</span>, <span style="color:#5bc4bf">[]</span>
</span></span><span style="display:flex;"><span>    task_list, task_list_done, <span style="color:#ef6155">task_list_fail</span> <span style="color:#5bc4bf">=</span> <span style="color:#5bc4bf">[]</span>, <span style="color:#5bc4bf">[]</span>, <span style="color:#5bc4bf">[]</span>
</span></span><span style="display:flex;"><span>    bug_list, bug_list_done, <span style="color:#ef6155">bug_list_fail</span> <span style="color:#5bc4bf">=</span> <span style="color:#5bc4bf">[]</span>, <span style="color:#5bc4bf">[]</span>, <span style="color:#5bc4bf">[]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ef6155">completed_statuses</span> <span style="color:#5bc4bf">=</span> <span style="color:#5bc4bf">{</span><span style="color:#48b685">&#34;å®Œæˆ&#34;</span>, <span style="color:#48b685">&#34;æµ‹è¯•ä¸­&#34;</span>, <span style="color:#48b685">&#34;æš‚ä¸å¤„ç†&#34;</span>, <span style="color:#48b685">&#34;æµ‹è¯•é€šè¿‡&#34;</span><span style="color:#5bc4bf">}</span>
</span></span><span style="display:flex;"><span>    INFO.logger.info<span style="color:#5bc4bf">(</span>f<span style="color:#48b685">&#34;æ­£åœ¨è·å–é¡¹ç›®çš„sprint typeä¿¡æ¯...&#34;</span><span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#815ba4">for</span> i in sprint_info_list:
</span></span><span style="display:flex;"><span>        <span style="color:#815ba4">if</span> str<span style="color:#5bc4bf">(</span>i.get<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#34;issue_type&#34;</span><span style="color:#5bc4bf">))</span> <span style="color:#5bc4bf">==</span> <span style="color:#48b685">&#34;æ•…äº‹&#34;</span>:
</span></span><span style="display:flex;"><span>            story_list.append<span style="color:#5bc4bf">(</span>i<span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#815ba4">if</span> str<span style="color:#5bc4bf">(</span>i.get<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#34;status&#34;</span><span style="color:#5bc4bf">))</span> in completed_statuses:
</span></span><span style="display:flex;"><span>                story_list_done.append<span style="color:#5bc4bf">(</span>i<span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#815ba4">else</span>:
</span></span><span style="display:flex;"><span>                story_list_fail.append<span style="color:#5bc4bf">(</span>i<span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#815ba4">elif</span> str<span style="color:#5bc4bf">(</span>i.get<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#34;issue_type&#34;</span><span style="color:#5bc4bf">))</span> <span style="color:#5bc4bf">==</span> <span style="color:#48b685">&#34;å­ä»»åŠ¡&#34;</span>:
</span></span><span style="display:flex;"><span>            task_list.append<span style="color:#5bc4bf">(</span>i<span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#815ba4">if</span> str<span style="color:#5bc4bf">(</span>i.get<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#34;status&#34;</span><span style="color:#5bc4bf">))</span> in completed_statuses:
</span></span><span style="display:flex;"><span>                task_list_done.append<span style="color:#5bc4bf">(</span>i<span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#815ba4">else</span>:
</span></span><span style="display:flex;"><span>                task_list_fail.append<span style="color:#5bc4bf">(</span>i<span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#815ba4">else</span>:
</span></span><span style="display:flex;"><span>            bug_list.append<span style="color:#5bc4bf">(</span>i<span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#815ba4">if</span> str<span style="color:#5bc4bf">(</span>i.get<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#34;status&#34;</span><span style="color:#5bc4bf">))</span> in completed_statuses:
</span></span><span style="display:flex;"><span>                bug_list_done.append<span style="color:#5bc4bf">(</span>i<span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#815ba4">else</span>:
</span></span><span style="display:flex;"><span>                bug_list_fail.append<span style="color:#5bc4bf">(</span>i<span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ef6155">all_done</span> <span style="color:#5bc4bf">=</span> len<span style="color:#5bc4bf">(</span>bug_list_done<span style="color:#5bc4bf">)</span> + len<span style="color:#5bc4bf">(</span>task_list_done<span style="color:#5bc4bf">)</span> + len<span style="color:#5bc4bf">(</span>story_list_done<span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ef6155">completion_rate</span> <span style="color:#5bc4bf">=</span> <span style="color:#5bc4bf">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#48b685">&#34;len_story&#34;</span>: len<span style="color:#5bc4bf">(</span>story_list<span style="color:#5bc4bf">)</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#48b685">&#34;len_task&#34;</span>: len<span style="color:#5bc4bf">(</span>task_list<span style="color:#5bc4bf">)</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#48b685">&#34;len_bug&#34;</span>: len<span style="color:#5bc4bf">(</span>bug_list<span style="color:#5bc4bf">)</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#48b685">&#34;len_all&#34;</span>: len<span style="color:#5bc4bf">(</span>sprint_info_list<span style="color:#5bc4bf">)</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#48b685">&#34;story_handle&#34;</span>: <span style="color:#5bc4bf">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#48b685">&#34;done&#34;</span>: len<span style="color:#5bc4bf">(</span>story_list_done<span style="color:#5bc4bf">)</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#48b685">&#34;fail&#34;</span>: len<span style="color:#5bc4bf">(</span>story_list_fail<span style="color:#5bc4bf">)</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#48b685">&#34;rate&#34;</span>: round<span style="color:#5bc4bf">((</span>len<span style="color:#5bc4bf">(</span>story_list_done<span style="color:#5bc4bf">)</span> / len<span style="color:#5bc4bf">(</span>story_list<span style="color:#5bc4bf">))</span> * 100, 2<span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#5bc4bf">}</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#48b685">&#34;task_handle&#34;</span>: <span style="color:#5bc4bf">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#48b685">&#34;done&#34;</span>: len<span style="color:#5bc4bf">(</span>task_list_done<span style="color:#5bc4bf">)</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#48b685">&#34;fail&#34;</span>: len<span style="color:#5bc4bf">(</span>task_list_fail<span style="color:#5bc4bf">)</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#48b685">&#34;rate&#34;</span>: round<span style="color:#5bc4bf">((</span>len<span style="color:#5bc4bf">(</span>task_list_done<span style="color:#5bc4bf">)</span> / len<span style="color:#5bc4bf">(</span>task_list<span style="color:#5bc4bf">))</span> * 100, 2<span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#5bc4bf">}</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#48b685">&#34;bug_handle&#34;</span>: <span style="color:#5bc4bf">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#48b685">&#34;done&#34;</span>: len<span style="color:#5bc4bf">(</span>bug_list_done<span style="color:#5bc4bf">)</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#48b685">&#34;fail&#34;</span>: len<span style="color:#5bc4bf">(</span>bug_list_fail<span style="color:#5bc4bf">)</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#48b685">&#34;rate&#34;</span>: round<span style="color:#5bc4bf">((</span>len<span style="color:#5bc4bf">(</span>bug_list_done<span style="color:#5bc4bf">)</span> / len<span style="color:#5bc4bf">(</span>bug_list<span style="color:#5bc4bf">))</span> * 100, 2<span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#5bc4bf">}</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#48b685">&#34;all_handle&#34;</span>: <span style="color:#5bc4bf">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#48b685">&#34;done&#34;</span>: all_done,
</span></span><span style="display:flex;"><span>            <span style="color:#48b685">&#34;fail&#34;</span>: len<span style="color:#5bc4bf">(</span>bug_list_fail<span style="color:#5bc4bf">)</span> + len<span style="color:#5bc4bf">(</span>task_list_fail<span style="color:#5bc4bf">)</span> + len<span style="color:#5bc4bf">(</span>story_list_fail<span style="color:#5bc4bf">)</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#48b685">&#34;rate&#34;</span>: round<span style="color:#5bc4bf">((</span>all_done / len<span style="color:#5bc4bf">(</span>sprint_info_list<span style="color:#5bc4bf">))</span> * 100, 2<span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#5bc4bf">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5bc4bf">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#815ba4">return</span> completion_rate
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>def user_msg_data<span style="color:#5bc4bf">(</span>sprint_info_list: list<span style="color:#5bc4bf">)</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#48b685">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">    äººå‘˜çš„æ•°æ®ç»Ÿè®¡ï¼Œè¿”å›å¡ç‰‡çš„jsonæ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">    :param sprint_info_list: åŒ…å«ä»»åŠ¡ä¿¡æ¯çš„åˆ—è¡¨ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯å­—å…¸ç±»å‹
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#815ba4">if</span> not isinstance<span style="color:#5bc4bf">(</span>sprint_info_list, list<span style="color:#5bc4bf">)</span>:
</span></span><span style="display:flex;"><span>        raise ValueError<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#34;è¾“å…¥å‚æ•°å¿…é¡»æ˜¯ä¸€ä¸ªåˆ—è¡¨&#34;</span><span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#815ba4">if</span> not all<span style="color:#5bc4bf">(</span>isinstance<span style="color:#5bc4bf">(</span>item, dict<span style="color:#5bc4bf">)</span> <span style="color:#815ba4">for</span> item in sprint_info_list<span style="color:#5bc4bf">)</span>:
</span></span><span style="display:flex;"><span>        raise ValueError<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#34;åˆ—è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½å¿…é¡»æ˜¯ä¸€ä¸ªå­—å…¸&#34;</span><span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ef6155">data_msg</span> <span style="color:#5bc4bf">=</span> <span style="color:#5bc4bf">{</span>å¡ç‰‡ä¸­ä¸€åˆ—çš„ä»£ç ï¼Œæˆ‘è¿™é‡Œåšçš„æ˜¯å¾ªç¯å¡«å……ç”Ÿæˆçš„<span style="color:#5bc4bf">}</span> <span style="color:#776e71">#TODO</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ef6155">issue_types</span> <span style="color:#5bc4bf">=</span> <span style="color:#5bc4bf">[</span><span style="color:#48b685">&#39;æ•…äº‹&#39;</span>, <span style="color:#48b685">&#39;æ•…éšœ&#39;</span>, <span style="color:#48b685">&#39;å­ä»»åŠ¡&#39;</span>, <span style="color:#48b685">&#39;ä»»åŠ¡&#39;</span>, <span style="color:#48b685">&#39;æ•…äº‹ç‚¹&#39;</span><span style="color:#5bc4bf">]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ef6155">issue_status</span> <span style="color:#5bc4bf">=</span> <span style="color:#5bc4bf">[</span><span style="color:#48b685">&#34;å®Œæˆ&#34;</span>, <span style="color:#48b685">&#34;æµ‹è¯•ä¸­&#34;</span>, <span style="color:#48b685">&#34;æš‚ä¸å¤„ç†&#34;</span>, <span style="color:#48b685">&#34;æµ‹è¯•é€šè¿‡&#34;</span>, <span style="color:#48b685">&#34;å¾…åŠ&#34;</span>, <span style="color:#48b685">&#34;äº§å“éªŒæ”¶ä¸­&#34;</span>, <span style="color:#48b685">&#34;å¼€å‘ä¸­&#34;</span><span style="color:#5bc4bf">]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ef6155">done_status</span> <span style="color:#5bc4bf">=</span> <span style="color:#5bc4bf">{</span><span style="color:#48b685">&#34;å®Œæˆ&#34;</span>, <span style="color:#48b685">&#34;æµ‹è¯•ä¸­&#34;</span>, <span style="color:#48b685">&#34;æš‚ä¸å¤„ç†&#34;</span>, <span style="color:#48b685">&#34;æµ‹è¯•é€šè¿‡&#34;</span>, <span style="color:#48b685">&#34;äº§å“éªŒæ”¶ä¸­&#34;</span><span style="color:#5bc4bf">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ef6155">issue_types_dones</span> <span style="color:#5bc4bf">=</span> <span style="color:#5bc4bf">[</span><span style="color:#48b685">&#39;æ•…äº‹å®Œæˆæ•°&#39;</span>, <span style="color:#48b685">&#39;æ•…éšœå®Œæˆæ•°&#39;</span>, <span style="color:#48b685">&#39;å­ä»»åŠ¡å®Œæˆæ•°&#39;</span>, <span style="color:#48b685">&#39;ä»»åŠ¡å®Œæˆæ•°&#39;</span><span style="color:#5bc4bf">]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ef6155">type_counts</span> <span style="color:#5bc4bf">=</span> <span style="color:#5bc4bf">{</span>t: <span style="color:#f99b15">0</span> <span style="color:#815ba4">for</span> t in issue_types<span style="color:#5bc4bf">}</span>  <span style="color:#776e71"># åˆå§‹åŒ–è®¡æ•°</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ef6155">status_counts</span> <span style="color:#5bc4bf">=</span> <span style="color:#5bc4bf">{</span>t: <span style="color:#f99b15">0</span> <span style="color:#815ba4">for</span> t in issue_status<span style="color:#5bc4bf">}</span>  <span style="color:#776e71"># åˆå§‹åŒ–è®¡æ•°</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ef6155">issue_types_counts</span> <span style="color:#5bc4bf">=</span> <span style="color:#5bc4bf">{</span>t: <span style="color:#f99b15">0</span> <span style="color:#815ba4">for</span> t in issue_types_dones<span style="color:#5bc4bf">}</span>  <span style="color:#776e71"># åˆå§‹åŒ–è®¡æ•°</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ef6155">user_counts</span> <span style="color:#5bc4bf">=</span> <span style="color:#5bc4bf">{}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ef6155">data_msg_list</span> <span style="color:#5bc4bf">=</span> <span style="color:#5bc4bf">[]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#815ba4">for</span> user_data in sprint_info_list:
</span></span><span style="display:flex;"><span>        <span style="color:#ef6155">assignee</span> <span style="color:#5bc4bf">=</span> user_data.get<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#34;assignee&#34;</span><span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#815ba4">if</span> assignee is not None:
</span></span><span style="display:flex;"><span>            <span style="color:#815ba4">if</span> assignee not in user_counts:
</span></span><span style="display:flex;"><span>                user_counts<span style="color:#5bc4bf">[</span>assignee<span style="color:#5bc4bf">]</span> <span style="color:#5bc4bf">=</span> <span style="color:#5bc4bf">{</span><span style="color:#48b685">&#39;total&#39;</span>: 0, **type_counts, **status_counts, **issue_types_counts<span style="color:#5bc4bf">}</span>
</span></span><span style="display:flex;"><span>            user_counts<span style="color:#5bc4bf">[</span>assignee<span style="color:#5bc4bf">][</span><span style="color:#48b685">&#39;total&#39;</span><span style="color:#5bc4bf">]</span> +<span style="color:#5bc4bf">=</span> <span style="color:#f99b15">1</span>
</span></span><span style="display:flex;"><span>            <span style="color:#815ba4">if</span> user_data.get<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#39;customfield_10106&#39;</span><span style="color:#5bc4bf">)</span>:
</span></span><span style="display:flex;"><span>                user_counts<span style="color:#5bc4bf">[</span>assignee<span style="color:#5bc4bf">][</span><span style="color:#48b685">&#39;æ•…äº‹ç‚¹&#39;</span><span style="color:#5bc4bf">]</span> +<span style="color:#5bc4bf">=</span> float<span style="color:#5bc4bf">(</span>user_data.get<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#39;customfield_10106&#39;</span><span style="color:#5bc4bf">))</span>
</span></span><span style="display:flex;"><span>            <span style="color:#815ba4">for</span> issue_type in issue_types:
</span></span><span style="display:flex;"><span>                <span style="color:#815ba4">if</span> str<span style="color:#5bc4bf">(</span>user_data.get<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#39;issue_type&#39;</span><span style="color:#5bc4bf">))</span> <span style="color:#5bc4bf">==</span> issue_type:
</span></span><span style="display:flex;"><span>                    user_counts<span style="color:#5bc4bf">[</span>assignee<span style="color:#5bc4bf">][</span>issue_type<span style="color:#5bc4bf">]</span> +<span style="color:#5bc4bf">=</span> <span style="color:#f99b15">1</span>
</span></span><span style="display:flex;"><span>            <span style="color:#815ba4">for</span> issue_statu in issue_status:
</span></span><span style="display:flex;"><span>                <span style="color:#815ba4">if</span> str<span style="color:#5bc4bf">(</span>user_data.get<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#39;status&#39;</span><span style="color:#5bc4bf">))</span> <span style="color:#5bc4bf">==</span> issue_statu:
</span></span><span style="display:flex;"><span>                    user_counts<span style="color:#5bc4bf">[</span>assignee<span style="color:#5bc4bf">][</span>issue_statu<span style="color:#5bc4bf">]</span> +<span style="color:#5bc4bf">=</span> <span style="color:#f99b15">1</span>
</span></span><span style="display:flex;"><span>            <span style="color:#815ba4">for</span> issue_types_done in issue_types_dones:
</span></span><span style="display:flex;"><span>                <span style="color:#ef6155">issue_type_str</span> <span style="color:#5bc4bf">=</span> issue_types_done<span style="color:#5bc4bf">[</span>:-3<span style="color:#5bc4bf">]</span>
</span></span><span style="display:flex;"><span>                <span style="color:#815ba4">if</span> str<span style="color:#5bc4bf">(</span>user_data.get<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#39;issue_type&#39;</span><span style="color:#5bc4bf">))</span> <span style="color:#5bc4bf">==</span> issue_type_str and str<span style="color:#5bc4bf">(</span>user_data.get<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#39;status&#39;</span><span style="color:#5bc4bf">))</span> in done_status:
</span></span><span style="display:flex;"><span>                    user_counts<span style="color:#5bc4bf">[</span>assignee<span style="color:#5bc4bf">][</span>issue_types_done<span style="color:#5bc4bf">]</span> +<span style="color:#5bc4bf">=</span> <span style="color:#f99b15">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#815ba4">else</span>:
</span></span><span style="display:flex;"><span>            ERROR.logger.error<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#34;assigneeå­—æ®µä¸ºç©º&#34;</span><span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#776e71"># è¾“å‡ºç»“æœ one {&#39;total&#39;: 22, &#39;æ•…äº‹&#39;: 6, &#39;æ•…éšœ&#39;: 6, &#39;å­ä»»åŠ¡&#39;: 10}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#815ba4">for</span> data_key, data_value in user_counts.items<span style="color:#5bc4bf">()</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ef6155">count</span> <span style="color:#5bc4bf">=</span> <span style="color:#f99b15">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#815ba4">for</span> k, v in data_value.items<span style="color:#5bc4bf">()</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#815ba4">if</span> k in done_status:
</span></span><span style="display:flex;"><span>                <span style="color:#ef6155">count</span> <span style="color:#5bc4bf">+=</span> v
</span></span><span style="display:flex;"><span>        <span style="color:#776e71"># print(data_key, data_value, count)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ef6155">task_num</span> <span style="color:#5bc4bf">=</span> int<span style="color:#5bc4bf">(</span>data_value.get<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#39;ä»»åŠ¡&#39;</span><span style="color:#5bc4bf">))</span> + int<span style="color:#5bc4bf">(</span>data_value.get<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#39;å­ä»»åŠ¡&#39;</span><span style="color:#5bc4bf">))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ef6155">done_task_num</span> <span style="color:#5bc4bf">=</span> int<span style="color:#5bc4bf">(</span>data_value.get<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#39;å­ä»»åŠ¡å®Œæˆæ•°&#39;</span><span style="color:#5bc4bf">))</span> + int<span style="color:#5bc4bf">(</span>data_value.get<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#39;ä»»åŠ¡å®Œæˆæ•°&#39;</span><span style="color:#5bc4bf">))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ef6155">userid</span> <span style="color:#5bc4bf">=</span> get_user_id<span style="color:#5bc4bf">(</span>data_key<span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ef6155">data_msg_copy</span> <span style="color:#5bc4bf">=</span> copy.deepcopy<span style="color:#5bc4bf">(</span>data_msg<span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>        data_msg_copy<span style="color:#5bc4bf">[</span><span style="color:#48b685">&#34;columns&#34;</span><span style="color:#5bc4bf">][</span>0<span style="color:#5bc4bf">][</span><span style="color:#48b685">&#34;elements&#34;</span><span style="color:#5bc4bf">][</span>0<span style="color:#5bc4bf">][</span><span style="color:#48b685">&#34;persons&#34;</span><span style="color:#5bc4bf">][</span>0<span style="color:#5bc4bf">][</span><span style="color:#48b685">&#34;id&#34;</span><span style="color:#5bc4bf">]</span> <span style="color:#5bc4bf">=</span> userid
</span></span><span style="display:flex;"><span>        data_msg_copy<span style="color:#5bc4bf">[</span><span style="color:#48b685">&#34;columns&#34;</span><span style="color:#5bc4bf">][</span>1<span style="color:#5bc4bf">][</span><span style="color:#48b685">&#34;elements&#34;</span><span style="color:#5bc4bf">][</span>0<span style="color:#5bc4bf">][</span><span style="color:#48b685">&#34;columns&#34;</span><span style="color:#5bc4bf">][</span>0<span style="color:#5bc4bf">][</span><span style="color:#48b685">&#34;elements&#34;</span><span style="color:#5bc4bf">][</span>0<span style="color:#5bc4bf">][</span><span style="color:#48b685">&#34;text&#34;</span><span style="color:#5bc4bf">][</span>
</span></span><span style="display:flex;"><span>            <span style="color:#48b685">&#34;content&#34;</span><span style="color:#5bc4bf">]</span> <span style="color:#5bc4bf">=</span> f<span style="color:#48b685">&#34;{data_value.get(&#39;æ•…äº‹å®Œæˆæ•°&#39;)}/{data_value.get(&#39;æ•…äº‹&#39;)}ä¸ª&#34;</span>
</span></span><span style="display:flex;"><span>        data_msg_copy<span style="color:#5bc4bf">[</span><span style="color:#48b685">&#34;columns&#34;</span><span style="color:#5bc4bf">][</span>2<span style="color:#5bc4bf">][</span><span style="color:#48b685">&#34;elements&#34;</span><span style="color:#5bc4bf">][</span>0<span style="color:#5bc4bf">][</span><span style="color:#48b685">&#34;columns&#34;</span><span style="color:#5bc4bf">][</span>0<span style="color:#5bc4bf">][</span><span style="color:#48b685">&#34;elements&#34;</span><span style="color:#5bc4bf">][</span>0<span style="color:#5bc4bf">][</span><span style="color:#48b685">&#34;text&#34;</span><span style="color:#5bc4bf">][</span>
</span></span><span style="display:flex;"><span>            <span style="color:#48b685">&#34;content&#34;</span><span style="color:#5bc4bf">]</span> <span style="color:#5bc4bf">=</span> f<span style="color:#48b685">&#34;{done_task_num}/{task_num}ä¸ª&#34;</span>
</span></span><span style="display:flex;"><span>        data_msg_copy<span style="color:#5bc4bf">[</span><span style="color:#48b685">&#34;columns&#34;</span><span style="color:#5bc4bf">][</span>3<span style="color:#5bc4bf">][</span><span style="color:#48b685">&#34;elements&#34;</span><span style="color:#5bc4bf">][</span>0<span style="color:#5bc4bf">][</span><span style="color:#48b685">&#34;columns&#34;</span><span style="color:#5bc4bf">][</span>0<span style="color:#5bc4bf">][</span><span style="color:#48b685">&#34;elements&#34;</span><span style="color:#5bc4bf">][</span>0<span style="color:#5bc4bf">][</span><span style="color:#48b685">&#34;text&#34;</span><span style="color:#5bc4bf">][</span>
</span></span><span style="display:flex;"><span>            <span style="color:#48b685">&#34;content&#34;</span><span style="color:#5bc4bf">]</span> <span style="color:#5bc4bf">=</span> f<span style="color:#48b685">&#34;{data_value.get(&#39;æ•…éšœå®Œæˆæ•°&#39;)}/{data_value.get(&#39;æ•…éšœ&#39;)}ä¸ª&#34;</span>
</span></span><span style="display:flex;"><span>        data_msg_copy<span style="color:#5bc4bf">[</span><span style="color:#48b685">&#34;columns&#34;</span><span style="color:#5bc4bf">][</span>4<span style="color:#5bc4bf">][</span><span style="color:#48b685">&#34;elements&#34;</span><span style="color:#5bc4bf">][</span>0<span style="color:#5bc4bf">][</span><span style="color:#48b685">&#34;columns&#34;</span><span style="color:#5bc4bf">][</span>0<span style="color:#5bc4bf">][</span><span style="color:#48b685">&#34;elements&#34;</span><span style="color:#5bc4bf">][</span>0<span style="color:#5bc4bf">][</span><span style="color:#48b685">&#34;text&#34;</span><span style="color:#5bc4bf">][</span>
</span></span><span style="display:flex;"><span>            <span style="color:#48b685">&#34;content&#34;</span><span style="color:#5bc4bf">]</span> <span style="color:#5bc4bf">=</span> f<span style="color:#48b685">&#34;{data_value.get(&#39;æ•…äº‹ç‚¹&#39;)}ä¸ª&#34;</span>
</span></span><span style="display:flex;"><span>        data_msg_copy<span style="color:#5bc4bf">[</span><span style="color:#48b685">&#34;columns&#34;</span><span style="color:#5bc4bf">][</span>5<span style="color:#5bc4bf">][</span><span style="color:#48b685">&#34;elements&#34;</span><span style="color:#5bc4bf">][</span>0<span style="color:#5bc4bf">][</span>
</span></span><span style="display:flex;"><span>            <span style="color:#48b685">&#34;content&#34;</span><span style="color:#5bc4bf">]</span> <span style="color:#5bc4bf">=</span> f<span style="color:#48b685">&#34;({int(count)}/{int(data_value.get(&#39;total&#39;))}) &lt;font color=&#39;red&#39;&gt;{round((int(count) / int(data_value.get(&#39;total&#39;))) * 100, 2)}%&lt;/font&gt;&#34;</span>
</span></span><span style="display:flex;"><span>        data_msg_list.append<span style="color:#5bc4bf">(</span>data_msg_copy<span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#815ba4">return</span> data_msg_list
</span></span></code></pre></div><h2 id="é£ä¹¦apiå‘é€">é£ä¹¦APIå‘é€<a hidden class="anchor" aria-hidden="true" href="#é£ä¹¦apiå‘é€">#</a></h2>
<ol>
<li>é£ä¹¦APIè®¤è¯</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Bash" data-lang="Bash"><span style="display:flex;"><span><span style="color:#776e71">#!/usr/bin/env python3.10.6
</span></span></span><span style="display:flex;"><span><span style="color:#776e71"></span><span style="color:#776e71"># -*- coding: utf-8 -*-</span>
</span></span><span style="display:flex;"><span><span style="color:#776e71"># Author: Bobby Sheng &lt;Bobby@sky-cloud.net&gt;</span>
</span></span><span style="display:flex;"><span>from units.get_config_data import get_config_yaml_data
</span></span><span style="display:flex;"><span>import requests
</span></span><span style="display:flex;"><span>import jsonpath
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ef6155">Config</span> <span style="color:#5bc4bf">=</span> get_config_yaml_data<span style="color:#5bc4bf">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>def tenant_access_token<span style="color:#5bc4bf">()</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#48b685">&#34;&#34;&#34;è·å–å¼•ç”¨tenant_access_token
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">    :return: tenant_access_token
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ef6155">data</span> <span style="color:#5bc4bf">=</span> <span style="color:#5bc4bf">{</span><span style="color:#48b685">&#34;app_id&#34;</span>: jsonpath.jsonpath<span style="color:#5bc4bf">(</span>Config, <span style="color:#48b685">&#34;</span>$<span style="color:#48b685">.feishu.app_id&#34;</span><span style="color:#5bc4bf">)[</span>0<span style="color:#5bc4bf">]</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#48b685">&#34;app_secret&#34;</span>: jsonpath.jsonpath<span style="color:#5bc4bf">(</span>Config, <span style="color:#48b685">&#34;</span>$<span style="color:#48b685">.feishu.app_secret&#34;</span><span style="color:#5bc4bf">)[</span>0<span style="color:#5bc4bf">]}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ef6155">res</span> <span style="color:#5bc4bf">=</span> requests.post<span style="color:#5bc4bf">(</span>jsonpath.jsonpath<span style="color:#5bc4bf">(</span>Config, <span style="color:#48b685">&#34;</span>$<span style="color:#48b685">.feishu.webhook_token&#34;</span><span style="color:#5bc4bf">)[</span>0<span style="color:#5bc4bf">]</span>, <span style="color:#ef6155">data</span><span style="color:#5bc4bf">=</span>data<span style="color:#5bc4bf">)</span>.json<span style="color:#5bc4bf">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ef6155">headers</span> <span style="color:#5bc4bf">=</span> <span style="color:#5bc4bf">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#48b685">&#39;Content-Type&#39;</span>: <span style="color:#48b685">&#39;application/json&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#48b685">&#39;Authorization&#39;</span>: <span style="color:#48b685">&#34;Bearer &#34;</span> + res<span style="color:#5bc4bf">[</span><span style="color:#48b685">&#34;app_access_token&#34;</span><span style="color:#5bc4bf">]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5bc4bf">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#815ba4">return</span> headers
</span></span></code></pre></div><ol>
<li>é£ä¹¦å¡ç‰‡æ¶ˆæ¯å‘é€</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Bash" data-lang="Bash"><span style="display:flex;"><span><span style="color:#776e71">#!/usr/bin/env python3.10.6
</span></span></span><span style="display:flex;"><span><span style="color:#776e71"></span><span style="color:#776e71"># -*- coding: utf-8 -*-</span>
</span></span><span style="display:flex;"><span><span style="color:#776e71"># Author: Bobby Sheng &lt;Bobby@sky-cloud.net&gt;</span>
</span></span><span style="display:flex;"><span>import requests
</span></span><span style="display:flex;"><span>import json
</span></span><span style="display:flex;"><span>import time
</span></span><span style="display:flex;"><span>import jsonpath
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>from units.get_config_data import get_config_yaml_data
</span></span><span style="display:flex;"><span>from units.log_control import INFO
</span></span><span style="display:flex;"><span>from feushu_api.feishu_login import tenant_access_token
</span></span><span style="display:flex;"><span>from jira_business.jira_sprint_msg import user_msg_data, get_backlog_issues, job_completion_rate
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ef6155">data_msg</span> <span style="color:#5bc4bf">=</span> <span style="color:#5bc4bf">{</span>å¡ç‰‡æºä»£ç <span style="color:#5bc4bf">}</span> <span style="color:#776e71">#TODO</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#776e71"># ${sprint}  ${ALL} ${story_all} ${bug_all} ${task_all} ${story_fail} ${story_done} ${story_rate} ${bug_fail} ${bug_done} ${bug_rate}</span>
</span></span><span style="display:flex;"><span><span style="color:#776e71"># ${task_fail} ${task_done} ${task_rate} ${all_fail} ${all_done} ${all_rate}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>def send_sprint_msg<span style="color:#5bc4bf">()</span>:
</span></span><span style="display:flex;"><span>    sprint_info_list, <span style="color:#ef6155">sprint_name</span> <span style="color:#5bc4bf">=</span> get_backlog_issues<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#39;INET&#39;</span><span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#776e71"># # å¼€å‘è€…æ•°æ®ç»Ÿè®¡</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ef6155">data_msg_list</span> <span style="color:#5bc4bf">=</span> user_msg_data<span style="color:#5bc4bf">(</span>sprint_info_list<span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    c.get<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#34;i18n_elements&#34;</span><span style="color:#5bc4bf">)</span>.get<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#39;zh_cn&#39;</span><span style="color:#5bc4bf">)</span>.extend<span style="color:#5bc4bf">(</span>data_msg_list<span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#776e71"># å·¥å•æ•°æ®ç»Ÿè®¡</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ef6155">job_data</span> <span style="color:#5bc4bf">=</span> job_completion_rate<span style="color:#5bc4bf">(</span>sprint_info_list<span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ef6155">c1</span> <span style="color:#5bc4bf">=</span> json.dumps<span style="color:#5bc4bf">(</span>c<span style="color:#5bc4bf">)</span>.replace<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#34;</span><span style="color:#f99b15">${</span><span style="color:#ef6155">sprint</span><span style="color:#f99b15">}</span><span style="color:#48b685">&#34;</span>, sprint_name<span style="color:#5bc4bf">)</span>.replace<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#34;</span><span style="color:#f99b15">${</span><span style="color:#ef6155">ALL</span><span style="color:#f99b15">}</span><span style="color:#48b685">&#34;</span>, str<span style="color:#5bc4bf">(</span>job_data<span style="color:#5bc4bf">[</span><span style="color:#48b685">&#34;len_all&#34;</span><span style="color:#5bc4bf">]))</span>.replace<span style="color:#5bc4bf">(</span>
</span></span><span style="display:flex;"><span>        <span style="color:#48b685">&#34;</span><span style="color:#f99b15">${</span><span style="color:#ef6155">story_all</span><span style="color:#f99b15">}</span><span style="color:#48b685">&#34;</span>,
</span></span><span style="display:flex;"><span>        str<span style="color:#5bc4bf">(</span>job_data<span style="color:#5bc4bf">[</span>
</span></span><span style="display:flex;"><span>                <span style="color:#48b685">&#34;len_story&#34;</span><span style="color:#5bc4bf">]))</span> <span style="color:#f99b15">\
</span></span></span><span style="display:flex;"><span><span style="color:#f99b15"></span>        .replace<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#34;</span><span style="color:#f99b15">${</span><span style="color:#ef6155">bug_all</span><span style="color:#f99b15">}</span><span style="color:#48b685">&#34;</span>, str<span style="color:#5bc4bf">(</span>job_data<span style="color:#5bc4bf">[</span><span style="color:#48b685">&#34;len_bug&#34;</span><span style="color:#5bc4bf">]))</span>.replace<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#34;</span><span style="color:#f99b15">${</span><span style="color:#ef6155">task_all</span><span style="color:#f99b15">}</span><span style="color:#48b685">&#34;</span>, str<span style="color:#5bc4bf">(</span>job_data<span style="color:#5bc4bf">[</span><span style="color:#48b685">&#34;len_task&#34;</span><span style="color:#5bc4bf">]))</span>. <span style="color:#f99b15">\
</span></span></span><span style="display:flex;"><span><span style="color:#f99b15"></span>        replace<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#34;</span><span style="color:#f99b15">${</span><span style="color:#ef6155">story_fail</span><span style="color:#f99b15">}</span><span style="color:#48b685">&#34;</span>, str<span style="color:#5bc4bf">(</span>job_data<span style="color:#5bc4bf">[</span><span style="color:#48b685">&#34;story_handle&#34;</span><span style="color:#5bc4bf">][</span><span style="color:#48b685">&#34;fail&#34;</span><span style="color:#5bc4bf">]))</span>.replace<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#34;</span><span style="color:#f99b15">${</span><span style="color:#ef6155">story_done</span><span style="color:#f99b15">}</span><span style="color:#48b685">&#34;</span>,
</span></span><span style="display:flex;"><span>                                                                                str<span style="color:#5bc4bf">(</span>job_data<span style="color:#5bc4bf">[</span><span style="color:#48b685">&#34;story_handle&#34;</span><span style="color:#5bc4bf">][</span><span style="color:#48b685">&#34;done&#34;</span><span style="color:#5bc4bf">]))</span>. <span style="color:#f99b15">\
</span></span></span><span style="display:flex;"><span><span style="color:#f99b15"></span>        replace<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#34;</span><span style="color:#f99b15">${</span><span style="color:#ef6155">story_rate</span><span style="color:#f99b15">}</span><span style="color:#48b685">&#34;</span>, str<span style="color:#5bc4bf">(</span>job_data<span style="color:#5bc4bf">[</span><span style="color:#48b685">&#34;story_handle&#34;</span><span style="color:#5bc4bf">][</span><span style="color:#48b685">&#34;rate&#34;</span><span style="color:#5bc4bf">]))</span>.replace<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#34;</span><span style="color:#f99b15">${</span><span style="color:#ef6155">bug_fail</span><span style="color:#f99b15">}</span><span style="color:#48b685">&#34;</span>,
</span></span><span style="display:flex;"><span>                                                                                str<span style="color:#5bc4bf">(</span>job_data<span style="color:#5bc4bf">[</span><span style="color:#48b685">&#34;bug_handle&#34;</span><span style="color:#5bc4bf">][</span><span style="color:#48b685">&#34;fail&#34;</span><span style="color:#5bc4bf">]))</span>. <span style="color:#f99b15">\
</span></span></span><span style="display:flex;"><span><span style="color:#f99b15"></span>        replace<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#34;</span><span style="color:#f99b15">${</span><span style="color:#ef6155">bug_done</span><span style="color:#f99b15">}</span><span style="color:#48b685">&#34;</span>, str<span style="color:#5bc4bf">(</span>job_data<span style="color:#5bc4bf">[</span><span style="color:#48b685">&#34;bug_handle&#34;</span><span style="color:#5bc4bf">][</span><span style="color:#48b685">&#34;done&#34;</span><span style="color:#5bc4bf">]))</span>.replace<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#34;</span><span style="color:#f99b15">${</span><span style="color:#ef6155">bug_rate</span><span style="color:#f99b15">}</span><span style="color:#48b685">&#34;</span>,
</span></span><span style="display:flex;"><span>                                                                            str<span style="color:#5bc4bf">(</span>job_data<span style="color:#5bc4bf">[</span><span style="color:#48b685">&#34;bug_handle&#34;</span><span style="color:#5bc4bf">][</span><span style="color:#48b685">&#34;rate&#34;</span><span style="color:#5bc4bf">]))</span>. <span style="color:#f99b15">\
</span></span></span><span style="display:flex;"><span><span style="color:#f99b15"></span>        replace<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#34;</span><span style="color:#f99b15">${</span><span style="color:#ef6155">task_fail</span><span style="color:#f99b15">}</span><span style="color:#48b685">&#34;</span>, str<span style="color:#5bc4bf">(</span>job_data<span style="color:#5bc4bf">[</span><span style="color:#48b685">&#34;task_handle&#34;</span><span style="color:#5bc4bf">][</span><span style="color:#48b685">&#34;fail&#34;</span><span style="color:#5bc4bf">]))</span>.replace<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#34;</span><span style="color:#f99b15">${</span><span style="color:#ef6155">task_done</span><span style="color:#f99b15">}</span><span style="color:#48b685">&#34;</span>,
</span></span><span style="display:flex;"><span>                                                                              str<span style="color:#5bc4bf">(</span>job_data<span style="color:#5bc4bf">[</span><span style="color:#48b685">&#34;task_handle&#34;</span><span style="color:#5bc4bf">][</span><span style="color:#48b685">&#34;done&#34;</span><span style="color:#5bc4bf">]))</span>. <span style="color:#f99b15">\
</span></span></span><span style="display:flex;"><span><span style="color:#f99b15"></span>        replace<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#34;</span><span style="color:#f99b15">${</span><span style="color:#ef6155">task_rate</span><span style="color:#f99b15">}</span><span style="color:#48b685">&#34;</span>, str<span style="color:#5bc4bf">(</span>job_data<span style="color:#5bc4bf">[</span><span style="color:#48b685">&#34;task_handle&#34;</span><span style="color:#5bc4bf">][</span><span style="color:#48b685">&#34;rate&#34;</span><span style="color:#5bc4bf">]))</span>.replace<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#34;</span><span style="color:#f99b15">${</span><span style="color:#ef6155">all_fail</span><span style="color:#f99b15">}</span><span style="color:#48b685">&#34;</span>,
</span></span><span style="display:flex;"><span>                                                                              str<span style="color:#5bc4bf">(</span>job_data<span style="color:#5bc4bf">[</span><span style="color:#48b685">&#34;all_handle&#34;</span><span style="color:#5bc4bf">][</span><span style="color:#48b685">&#34;fail&#34;</span><span style="color:#5bc4bf">]))</span>. <span style="color:#f99b15">\
</span></span></span><span style="display:flex;"><span><span style="color:#f99b15"></span>        replace<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#34;</span><span style="color:#f99b15">${</span><span style="color:#ef6155">all_done</span><span style="color:#f99b15">}</span><span style="color:#48b685">&#34;</span>, str<span style="color:#5bc4bf">(</span>job_data<span style="color:#5bc4bf">[</span><span style="color:#48b685">&#34;all_handle&#34;</span><span style="color:#5bc4bf">][</span><span style="color:#48b685">&#34;done&#34;</span><span style="color:#5bc4bf">]))</span>.replace<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#34;</span><span style="color:#f99b15">${</span><span style="color:#ef6155">all_rate</span><span style="color:#f99b15">}</span><span style="color:#48b685">&#34;</span>,
</span></span><span style="display:flex;"><span>                                                                            str<span style="color:#5bc4bf">(</span>job_data<span style="color:#5bc4bf">[</span><span style="color:#48b685">&#34;all_handle&#34;</span><span style="color:#5bc4bf">][</span><span style="color:#48b685">&#34;rate&#34;</span><span style="color:#5bc4bf">]))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ef6155">headers</span> <span style="color:#5bc4bf">=</span> tenant_access_token<span style="color:#5bc4bf">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ef6155">rich_text</span> <span style="color:#5bc4bf">=</span> <span style="color:#5bc4bf">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#48b685">&#34;receive_id&#34;</span>: <span style="color:#48b685">&#34;6b9eab87&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#48b685">&#34;msg_type&#34;</span>: <span style="color:#48b685">&#34;interactive&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#48b685">&#34;content&#34;</span>: c1
</span></span><span style="display:flex;"><span>    <span style="color:#5bc4bf">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#776e71"># oc_17703b85be608b568b1fed1c3a2f3110 æµ‹è¯•ç¾¤</span>
</span></span><span style="display:flex;"><span>    <span style="color:#776e71"># oc_672137dedd6b9104cdf1d99d5bdea47a ç ”å‘ç¾¤</span>
</span></span><span style="display:flex;"><span>    INFO.logger.info<span style="color:#5bc4bf">(</span>f<span style="color:#48b685">&#34;æ¶ˆæ¯æ¥å—è€…ï¼š6b9eab87&#34;</span><span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ef6155">post_data</span> <span style="color:#5bc4bf">=</span> json.dumps<span style="color:#5bc4bf">(</span>rich_text<span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ef6155">response</span> <span style="color:#5bc4bf">=</span> requests.post<span style="color:#5bc4bf">(</span>
</span></span><span style="display:flex;"><span>        jsonpath.jsonpath<span style="color:#5bc4bf">(</span>get_config_yaml_data<span style="color:#5bc4bf">()</span>, <span style="color:#48b685">&#34;</span>$<span style="color:#48b685">.feishu.webhook&#34;</span><span style="color:#5bc4bf">)[</span>0<span style="color:#5bc4bf">]</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ef6155">headers</span><span style="color:#5bc4bf">=</span>headers,
</span></span><span style="display:flex;"><span>        <span style="color:#ef6155">data</span><span style="color:#5bc4bf">=</span>post_data,
</span></span><span style="display:flex;"><span>        <span style="color:#ef6155">verify</span><span style="color:#5bc4bf">=</span>False
</span></span><span style="display:flex;"><span>    <span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ef6155">result</span> <span style="color:#5bc4bf">=</span> response.json<span style="color:#5bc4bf">()</span>
</span></span><span style="display:flex;"><span>    INFO.logger.info<span style="color:#5bc4bf">(</span>f<span style="color:#48b685">&#34;å‘é€æ¶ˆæ¯æ¥è¿”å›{result}&#34;</span><span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#815ba4">if</span> result.get<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#39;code&#39;</span><span style="color:#5bc4bf">)</span> !<span style="color:#5bc4bf">=</span> 0:
</span></span><span style="display:flex;"><span>        <span style="color:#ef6155">time_now</span> <span style="color:#5bc4bf">=</span> time.strftime<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#34;%Y-%m-%d %H:%M:%S&#34;</span>, time.localtime<span style="color:#5bc4bf">(</span>time.time<span style="color:#5bc4bf">()))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ef6155">result_msg</span> <span style="color:#5bc4bf">=</span> result<span style="color:#5bc4bf">[</span><span style="color:#48b685">&#39;errmsg&#39;</span><span style="color:#5bc4bf">]</span> <span style="color:#815ba4">if</span> result.get<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#39;errmsg&#39;</span>, False<span style="color:#5bc4bf">)</span> <span style="color:#815ba4">else</span> <span style="color:#48b685">&#39;æœªçŸ¥å¼‚å¸¸&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ef6155">error_data</span> <span style="color:#5bc4bf">=</span> <span style="color:#5bc4bf">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#48b685">&#34;msgtype&#34;</span>: <span style="color:#48b685">&#34;text&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#48b685">&#34;text&#34;</span>: <span style="color:#5bc4bf">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#48b685">&#34;content&#34;</span>: f<span style="color:#48b685">&#34;[æ³¨æ„-è‡ªåŠ¨é€šçŸ¥]é£ä¹¦æœºå™¨äººæ¶ˆæ¯å‘é€å¤±è´¥ï¼Œæ—¶é—´ï¼š{time_now}ï¼Œ&#34;</span>
</span></span><span style="display:flex;"><span>                           f<span style="color:#48b685">&#34;åŸå› ï¼š{result_msg}ï¼Œè¯·åŠæ—¶è·Ÿè¿›ï¼Œè°¢è°¢!&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#5bc4bf">}</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#48b685">&#34;at&#34;</span>: <span style="color:#5bc4bf">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#48b685">&#34;isAtAll&#34;</span>: False
</span></span><span style="display:flex;"><span>            <span style="color:#5bc4bf">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#5bc4bf">}</span>
</span></span><span style="display:flex;"><span>        INFO.logger.error<span style="color:#5bc4bf">(</span><span style="color:#48b685">&#34;æ¶ˆæ¯å‘é€å¤±è´¥ï¼Œè‡ªåŠ¨é€šçŸ¥ï¼š%s&#34;</span>, error_data<span style="color:#5bc4bf">)</span>
</span></span><span style="display:flex;"><span>        requests.post<span style="color:#5bc4bf">(</span>jsonpath.jsonpath<span style="color:#5bc4bf">(</span>get_config_yaml_data<span style="color:#5bc4bf">()</span>, <span style="color:#48b685">&#34;</span>$<span style="color:#48b685">.feishu.webhook&#34;</span><span style="color:#5bc4bf">)[</span>0<span style="color:#5bc4bf">]</span>, <span style="color:#ef6155">headers</span><span style="color:#5bc4bf">=</span>headers,
</span></span><span style="display:flex;"><span>                      <span style="color:#ef6155">data</span><span style="color:#5bc4bf">=</span>json.dumps<span style="color:#5bc4bf">(</span>error_data<span style="color:#5bc4bf">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#815ba4">if</span> <span style="color:#ef6155">__name__</span> <span style="color:#5bc4bf">==</span> <span style="color:#48b685">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    send_sprint_msg<span style="color:#5bc4bf">()</span>
</span></span></code></pre></div><ol>
<li>ä»£ç ç»“æ„</li>
</ol>
<p><img loading="lazy" src="https://telegraph-image-f19.pages.dev/file/fc55a34d51a37c7bfc2a5.jpg" alt="img.png"  />
</p>
<h1 id="æ•ˆæœå±•ç¤º">æ•ˆæœå±•ç¤º<a hidden class="anchor" aria-hidden="true" href="#æ•ˆæœå±•ç¤º">#</a></h1>
<p><img loading="lazy" src="https://telegraph-image-f19.pages.dev/file/32cd91c0beb04902e6d7f.jpg" alt="img.png"  />

<img loading="lazy" src="https://telegraph-image-f19.pages.dev/file/d9c2e7a72e47d3261c0ed.jpg" alt="img.png"  />

<img loading="lazy" src="https://telegraph-image-f19.pages.dev/file/d94a32479a9bec88602d8.jpg" alt="img.png"  />
</p>
<h1 id="æ€»ç»“">æ€»ç»“<a hidden class="anchor" aria-hidden="true" href="#æ€»ç»“">#</a></h1>
<p>ç©ºé—²æ—¶é—´ç¼–å†™ï¼Œæ²¡å¤ªå¤šæ—¶é—´å»æ„æ€ä»£ç è®¾è®¡ï¼Œä¸»è¦ä»¥å®ç°åŠŸèƒ½ä¸ºä¸»ï¼Œä»£ç å†™çš„ç®€å•ç²—æš´ã€‚æ›´å¤šçš„æ˜¯æä¾›ä¸€ç§æ€è·¯ã€‚</p>


        </div>
        <div class="post-reward">
            <div style="padding: 0 0 0 0; margin: 0 0 0 0; width: 100%; font-size:16px; text-align: center;">
                <div id="QR" style="opacity: 0;">
                    <div id="wechat" style="display: inline-block">
                        <a class="fancybox" rel="group">
                            <img id="wechat_qr" src="https://bobby-sheng.github.io/BobbySheng/img/wechat_pay.png" alt="wechat_pay"></a>
                        <p>å¾®ä¿¡</p>
                    </div>
                    <div id="alipay" style="display: inline-block">
                        <a class="fancybox" rel="group">
                            <img id="alipay_qr" src="https://bobby-sheng.github.io/BobbySheng/img/alipay.png" alt="alipay"></a>
                        <p>æ”¯ä»˜å®</p>
                    </div>
                </div>
                <button id="rewardButton"
                        onclick="
                    var qr = document.getElementById('QR');
                    if (qr.style.opacity === '0') {
                        qr.style.opacity='1';
                    } else {
                        qr.style.opacity='0'
                    }"
                >
                    <span>ğŸ§§ é¼“åŠ±</span>
                </button>
            </div>
        </div>

        <footer class="post-footer">
            
<nav class="paginav">
  <a class="prev" href="https://bobby-sheng.github.io/BobbySheng/en/posts/blog/%E5%9F%BA%E4%BA%8Ecloudflare%E6%90%AD%E5%BB%BAfor-myself%E5%85%8D%E8%B4%B9%E7%9A%84%E5%9B%BE%E5%BA%8A/">
    <span class="title">Â« Prev Page</span>
    <br>
    <span>åŸºäºcloudflareæ­å»ºFor Myselfå…è´¹çš„å›¾åºŠ</span>
  </a>
  <a class="next" href="https://bobby-sheng.github.io/BobbySheng/en/posts/blog/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%8C%85%E8%A7%A3%E7%A0%81/">
    <span class="title">Next Page Â»</span>
    <br>
    <span>å°ç¨‹åºåŒ…è§£ç </span>
  </a>
</nav>

        </footer>
    </div>




    

    
    
    
</article>
</main>


<footer class="footer">

    <a href="https://gohugo.io/" target="_blank">
        <img style="display: unset;" src="https://img.shields.io/badge/frame-hugo-blue?style=flat&logo=hugo">
    </a>
    <a href="https://github.com/adityatelange/hugo-PaperMod" target="_blank">
        <img style="display: unset;" src="https://img.shields.io/badge/theme-papermod-lightgrey?style=flat&logo=BookStack">
    </a>
        <a href="https://dash.cloudflare.com/" target="_blank">
        <img style="display: unset;" src="https://telegraph-image-f19.pages.dev/file/6b25043a544164be8f9d8.png">
    </a>

    <br>

    <span id="runtime_span"></span>
    <script
        type="text/javascript">function show_runtime() { window.setTimeout("show_runtime()", 1000); X = new Date("7/13/2021 1:00:00"); Y = new Date(); T = (Y.getTime() - X.getTime()); M = 24 * 60 * 60 * 1000; a = T / M; A = Math.floor(a); b = (a - A) * 24; B = Math.floor(b); c = (b - B) * 60; C = Math.floor((b - B) * 60); D = Math.floor((c - C) * 60); runtime_span.innerHTML = "ç½‘ç«™å·²è¿è¡Œ" + A + "å¤©" + B + "å°æ—¶" + C + "åˆ†" + D + "ç§’" } show_runtime();</script>
    |
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span id="busuanzi_container">
        
        æ€»è®¿å®¢æ•°:  <span id="busuanzi_value_site_uv"></span>
        |
        æ€»è®¿é—®é‡:  <span id="busuanzi_value_site_pv"></span>
    </span>

    <br>

    <a href="https://beian.miit.gov.cn/" target="_blank" style="border-bottom:1px solid">Bobby</a>&nbsp;
    |
    <span>
        Copyright
        &copy;
        2018-2024
        <a href="https://bobby-sheng.github.io/BobbySheng/en/" style="border-bottom:1px solid">Bobby Blog</a>
    </span>

    
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <span class="topInner">
        <svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z" />
        </svg>
        <span id="read_progress"></span>
    </span>
</a>

<script>
    document.addEventListener('scroll', function (e) {
        const readProgress = document.getElementById("read_progress");
        const scrollHeight = document.documentElement.scrollHeight;
        const clientHeight = document.documentElement.clientHeight;
        const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
        
        readProgress.innerText = ((scrollTop / (scrollHeight - clientHeight)).toFixed(2) * 100).toFixed(0);
    })
</script>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    let mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 400 || document.documentElement.scrollTop > 400) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };
</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>


<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'ğŸ“„copy';

        function copyingDone() {
            copybutton.innerText = 'ğŸ‘ŒğŸ»Code_copied!';
            setTimeout(() => {
                copybutton.innerText = 'ğŸ“„copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            
            
            
            
            
            
            
            
            
            
            
            
            
            

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) {
            }
            ;
            selection.removeRange(range);
        });

        let language = codeblock.className.replaceAll("language-", "")
        let macTool = document.createElement("div")
        let macTool1 = document.createElement("div")
        let macTool2 = document.createElement("div")
        let macTool3 = document.createElement("div")
        let languageType = document.createElement("div")
        languageType.innerText = language
        macTool.setAttribute('class', 'mac-tool')
        macTool1.setAttribute('class', 'mac bb1')
        macTool2.setAttribute('class', 'mac bb2')
        macTool3.setAttribute('class', 'mac bb3')
        languageType.setAttribute('class', 'language-type')
        macTool.appendChild(macTool1)
        macTool.appendChild(macTool2)
        macTool.appendChild(macTool3)
        macTool.appendChild(languageType)

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
            container.appendChild(macTool)
        } else if (container.parentNode.firstChild === container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName === "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
            container.appendChild(macTool)
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
            container.appendChild(macTool)
        }
    });
</script>

</body>

</html>
